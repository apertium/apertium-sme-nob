<?xml version="1.0" encoding="utf-8"?>

<!--
This is the first pass. Responsibilities of this file include:
* Chunking (all rules)
* Handling part-of-speech changes introduced by bidix.
  * Rules match on source tags, so a sme verb which is specified 
    as a nob noun has to be handled by the verb rule
    (this leads to some redundancy, hopefully we'll get a bidix module soon)
* (De-)compounding
  * See rule: NOM.CMP NOM
* goahti-derivation
  * See rule: VERB Der/goahti
* Simple noun phrases
  * Heads and their simple modifiers/specifiers: adj nom, adj adj nom, det adj adj nom, num adj nom
  * See rule: DET ADJ_ATTR NOM
  * See macro: out_nom
* Insert prepositions based on nominal case
  * These get their own chunk; t2x might have to remove them in co-ordination or post-position rules
    or might change them if the verb requires something else
  * See macro: set_caseprep
* Verb auxiliaries
  * Tags from sme verbs are used to output finite verb auxiliaries before the main verb.
    All verbs get their own chunks, as do lemq's (since they can move around noun phrases in t3x)
  * See macro: out_verb



DEF-CAT NAMING SCHEME:
                       lemma-pos.tag.tag_SYNTAG

where the SYNTAG part may have an l or r before or after to signify the arrow
(where l corresponds to ← and r to →);
alternatively the SYNTAG part is something like "mod", "attr" or "head".
And then there are some categories like "month", with all the months.

-->

<transfer default="chunk">
  <section-def-cats>
    <def-cat n="CLB">
      <cat-item tags="CLB"/>
    </def-cat>
    <def-cat n="adpos">
      <cat-item tags="Adp.*"/>
      <cat-item tags="Pr.*"/>
      <cat-item tags="Po.*"/>
    </def-cat>
    <def-cat n="postpos">
      <cat-item tags="Adp.*"/>
      <cat-item tags="Po.*"/>
    </def-cat>
    <def-cat n="adverb">
      <cat-item tags="Adv"/>
      <cat-item tags="Adv.*"/>
    </def-cat>
    <def-cat n="Pcle">
      <cat-item tags="Qst.Pcle.*"/>
      <cat-item tags="Qst.Pcle"/>
      <cat-item tags="Pcle.*"/>
      <cat-item tags="Pcle"/>
    </def-cat>
    <def-cat n="ij">
      <cat-item tags="Interj.*"/>
      <cat-item tags="Interj"/>
    </def-cat>
    <def-cat n="Qst.Pcle">
      <cat-item tags="Qst.Pcle"/>
      <cat-item tags="Qst.Pcle.*"/>
    </def-cat>
    <def-cat n="adj">
      <cat-item tags="A.*"/>
    </def-cat>
    <def-cat n="adj_attr">
      <cat-item tags="A.Ess.*"/>
      <cat-item tags="A.Attr"/>
      <cat-item tags="A.Attr.*"/>
      <cat-item tags="A.*.Attr.*"/>
      <!-- TODO: pstv verbs don't have adj forms, should have transfer
           <exception> if tl pstv -->
      <cat-item tags="V.IV.A.Attr.*"/>
      <cat-item tags="V.TV.A.Attr.*"/>
    </def-cat>
    <def-cat n="num_mod">
      <cat-item tags="Num.*.@→N"/>
      <cat-item tags="Num.*.@→A"/>
    </def-cat>
    <def-cat n="num">
      <cat-item tags="Num.*"/>
    </def-cat>
    <def-cat n="pron">
      <cat-item tags="Pron.*"/>
    </def-cat>
    <def-cat n="pron.rel">
      <cat-item tags="Pron.Rel.*"/>
    </def-cat>
    <def-cat n="pron.ref">
      <cat-item tags="Pron.Refl.*"/>
    </def-cat>
    <def-cat n="pron.ref_PRONl">
      <cat-item tags="Pron.Refl.*.@Pron←"/>
    </def-cat>
    <def-cat n="pronitg">
      <cat-item tags="Pron.Interr.*"/>
    </def-cat>
    <def-cat n="pron.pers">
      <cat-item tags="Pron.Pers.*"/>
    </def-cat>
    <def-cat n="pron.pers.gen">
      <cat-item tags="Pron.Pers.*.Gen.*"/>
    </def-cat>
    <def-cat n="det" c="Pronouns most likely to end up as determiners">
      <cat-item tags="Pron.Pers.*.Gen.*"/>
      <cat-item tags="Pron.Refl.Gen.*"/>
      <cat-item tags="Pron.Dem.*"/>
      <cat-item tags="Pron.Indef.*"/>
      <cat-item tags="Pron.Recipr.*"/>
      <cat-item tags="Pron.Dem"/>
      <cat-item tags="Pron.Indef"/>
      <cat-item tags="Pron.Recipr"/>
      <cat-item lemma="makkár" tags="Pron.Interr.*"/>
      <cat-item lemma="vaikko guhte" tags="Pron.Interr.*"/>
      <cat-item lemma="vaikko goabbá" tags="Pron.Interr.*"/>
    </def-cat>
    <def-cat n="det_mod" c="Pronouns most likely to end up as determiners, modifying an adj/noun">
      <cat-item tags="Pron.Pers.*.Gen.@→N"/>
      <cat-item tags="Pron.Pers.*.Gen.@→A"/>
      <cat-item tags="Pron.Refl.Gen.*.@→N"/>
      <cat-item tags="Pron.Refl.Gen.*.@→A"/>
      <cat-item tags="Pron.Refl.Gen.@→N"/>
      <cat-item tags="Pron.Refl.Gen.@→A"/>
      <cat-item tags="Pron.Dem.*.@→N"/>
      <cat-item tags="Pron.Dem.*.@→A"/>
      <cat-item tags="Pron.Indef.*.@→N"/>
      <cat-item tags="Pron.Indef.*.@→A"/>
      <cat-item tags="Pron.Indef.@→N"/>
      <cat-item tags="Pron.Indef.@→A"/>
      <cat-item lemma="makkár" tags="Pron.Interr.*.@→N"/>
      <cat-item lemma="makkár" tags="Pron.Interr.*.@→A"/>
    </def-cat>
    <def-cat n="cmp" c="Words only seen as compund parts">
      <cat-item tags="Cmp.*"/>
      <cat-item tags="ShCmp.*"/>
      <cat-item tags="Cmp"/>
      <cat-item tags="ShCmp"/>
    </def-cat>
    <def-cat n="adj.cmp">
      <cat-item tags="A.*.Cmp"/>
      <cat-item tags="A.*.Cmp.*"/>
    </def-cat>
    <def-cat n="nom.cmp">
      <cat-item tags="N.*.Cmp"/>
      <cat-item tags="N.*.Cmp.*"/>
    </def-cat>
    <def-cat n="nom_head" c="Head nom's are sent to out_nom, thus we can have Verb derivatives here.">
      <cat-item tags="V.*.Der2.*.N.*"/>
      <cat-item tags="N.*"/>
      <cat-item tags="ABBR"/>
      <cat-item tags="ABBR.*"/>
    </def-cat>
    <def-cat n="nom_rP" c="Head nom before a postposition, sent to out_nom">
      <cat-item tags="V.*.Der2.*.N.*.@→P"/>
      <cat-item tags="N.*.@→P"/>
      <cat-item tags="ABBR.*.@→P"/>
    </def-cat>
    <def-cat n="nom.gen">
      <cat-item tags="N.*.Gen.*"/>
    </def-cat>
    <def-cat n="nom.gen_NUMl">
      <cat-item tags="N.*.Gen.@Num←"/>
    </def-cat>
    <def-cat n="nom.prop.antcog_mod">
      <cat-item tags="N.Prop.Sur.*.@→N"/>
      <cat-item tags="N.Prop.Fem.*.@→N"/>
      <cat-item tags="N.Prop.Mal.*.@→N"/>
    </def-cat>
    <def-cat n="nom.prop.antcog">
      <cat-item tags="N.Prop.Sur.*"/>
      <cat-item tags="N.Prop.Fem.*"/>
      <cat-item tags="N.Prop.Mal.*"/>
    </def-cat>
    <def-cat n="nom.prop">
      <cat-item tags="N.Prop.*"/>
    </def-cat>
    <def-cat n="nom.prop_mod">
      <cat-item tags="N.Prop.*.Attr.*"/>
    </def-cat>
    <def-cat n="nom.prop.gen">
      <cat-item tags="N.Prop.*.Gen"/>
      <cat-item tags="N.Prop.*.Gen.*"/>
    </def-cat>
    <def-cat n="nom.prop_attr">
      <cat-item tags="N.Prop.Attr.*"/>
      <cat-item tags="N.*.@→N"/>
      <cat-item lemma="gonagas" tags="N.*"/>
      <cat-item lemma="gonagas:1" tags="N.*"/>
      <cat-item lemma="dronnet" tags="N.*"/>
      <cat-item lemma="prinsa" tags="N.*"/>
      <cat-item lemma="ruvdnaprinsa" tags="N.*"/>
      <cat-item lemma="prinseassa" tags="N.*"/>
      <cat-item lemma="ruvdnaprinseassa" tags="N.*"/>
    </def-cat>
    <def-cat n="verb">
      <cat-item tags="V.*"/>
    </def-cat>
    <def-cat n="v.actio">
      <cat-item tags="V.*.Actio.*"/>
    </def-cat>
    <def-cat n="goahti-v">
      <cat-item lemma="goahti" tags="V.*"/>
    </def-cat>
    <def-cat n="conj">
      <cat-item tags="CC.*"/>
      <cat-item tags="CS.*"/>
    </def-cat>
    <def-cat n="month">
      <cat-item lemma="guovvamánnu" tags="N.*"/>
      <cat-item lemma="ođđajagimánnu" tags="N.*"/>
      <cat-item lemma="guovvamánnu" tags="N.*"/>
      <cat-item lemma="njukčamánnu" tags="N.*"/>
      <cat-item lemma="cuoŋománnu" tags="N.*"/>
      <cat-item lemma="miessemánnu" tags="N.*"/>
      <cat-item lemma="geassemánnu" tags="N.*"/>
      <cat-item lemma="suoidnemánnu" tags="N.*"/>
      <cat-item lemma="borgemánnu" tags="N.*"/>
      <cat-item lemma="čakčamánnu" tags="N.*"/>
      <cat-item lemma="golggotmánnu" tags="N.*"/>
      <cat-item lemma="skábmamánnu" tags="N.*"/>
      <cat-item lemma="juovlamánnu" tags="N.*"/>
    </def-cat>
    <def-cat n="season">
      <cat-item lemma="giđđa" tags="N.*"/>
      <cat-item lemma="geassi" tags="N.*"/>
      <cat-item lemma="dálvi" tags="N.*"/>
      <cat-item lemma="čakča" tags="N.*"/>
    </def-cat>
    <def-cat n="num.cmp">
      <cat-item tags="Num.Cmp"/>
      <cat-item tags="Num.*.Cmp"/>
    </def-cat>
    <def-cat n="diibmu">
      <cat-item lemma="diibmu" tags="N.*"/>
      <cat-item lemma="diibmu:1" tags="N.*"/>
    </def-cat>
    <def-cat n="lohku">
      <cat-item lemma="lohku" tags="N.*"/>
    </def-cat>
    <def-cat n="ord">
      <cat-item tags="A.Ord.*"/>
      <cat-item tags="A.Ord"/>
    </def-cat>
    <def-cat n="beaivi">
      <cat-item lemma="beaivi" tags="N.*"/>
      <cat-item lemma="b" tags="ABBR.*"/>
      <cat-item lemma="b" tags="N.ABBR.*"/>
      <cat-item lemma="b" tags="Adv.ABBR.*"/>
    </def-cat>
    <def-cat n="ij-adj">
      <cat-item lemma="buorre:1" tags="A.Sg.*"/>
      <cat-item lemma="ilolaš" tags="A.Sg.*"/>
      <cat-item lemma="ilolaš" tags="A.Attr.*"/>
    </def-cat>
    <def-cat n="ij-adj2">
      <cat-item lemma="ođas" tags="A.Attr.*"/>
    </def-cat>
    <def-cat n="ij-nom">
      <cat-item lemma="beaivi" tags="N.Sg.*"/>
      <cat-item lemma="eahket" tags="N.Sg.*"/>
      <cat-item lemma="idja" tags="N.Sg.*"/>
      <cat-item lemma="iđit" tags="N.Sg.*"/>
      <cat-item lemma="vahkkoloahppa" tags="N.Sg.*"/>
      <cat-item lemma="juovllat" tags="N.Pl.*"/>
      <cat-item lemma="jahki" tags="N.Sg.*"/>
    </def-cat>
    <def-cat n="pron-nonreferential">
      <!-- Turns to nt.sg in Norwegian if used as lone pron, although it may be pl in sme. -->
      <!-- See Nickel p.128–129, http://giellatekno.uit.no/oahpa/pronomen.nno.html#Ubestemte+pronomen -->
      <cat-item lemma="mihkkege" tags="Pron.*"/>
      <cat-item lemma="mihkke" tags="Pron.*"/>
      <cat-item lemma="giige" tags="Pron.*"/>
      <cat-item lemma="guhtege" tags="Pron.*"/>
      <cat-item lemma="goabbáge" tags="Pron.*"/>
      <cat-item lemma="guhtemušge" tags="Pron.*"/>
      <cat-item lemma="makkárge" tags="Pron.*"/>
      <cat-item lemma="oktage" tags="Pron.*"/>
    </def-cat>
  </section-def-cats>
  <section-def-attrs>
    <def-attr n="a_der">
      <attr-item tags="Der1.Der2.Der_halla"/>
    </def-attr>
    <def-attr n="a_sintagma">
      <attr-item tags="SN"/>
      <attr-item tags="SV"/>
      <attr-item tags="SA"/>
    </def-attr>
    <def-attr n="a_verb">
      <attr-item tags="V"/>
      <attr-item tags="vblex"/>
    </def-attr>
    <def-attr n="a_pstv">
      <attr-item tags="pstv"/>
    </def-attr>
    <def-attr n="a_lemq">
      <attr-item tags="lemq-obj"/>
    </def-attr>
    <def-attr n="a_adj">
      <attr-item tags="A"/>
      <attr-item tags="adj"/>
      <attr-item tags="adj.pp"/>
      <attr-item tags="adj.pprs"/>
      <attr-item tags="adj.sint"/>
      <attr-item tags="adj.sint.pp"/>
      <attr-item tags="adj.sint.pprs"/>
    </def-attr>
    <def-attr n="a_adj-pure">
      <attr-item tags="A"/>
      <attr-item tags="adj"/>
      <attr-item tags="adj.sint"/>
    </def-attr>
    <def-attr n="a_adv">
      <attr-item tags="Adv"/>
      <attr-item tags="adv"/>
    </def-attr>
    <def-attr n="a_ij">
      <attr-item tags="Ij"/>
      <attr-item tags="ij"/>
    </def-attr>
    <def-attr n="a_prep">
      <attr-item tags="Po"/>
      <attr-item tags="Pr"/>
      <attr-item tags="pr"/>
    </def-attr>
    <def-attr n="a_num">
      <attr-item tags="Num"/>
      <attr-item tags="det.qnt"/>
    </def-attr>
    <def-attr n="a_cmp">
      <attr-item tags="Cmp"/>
      <attr-item tags="cmp"/>
      <attr-item tags="dash"/>
      <attr-item tags="RCmpnd"/>
    </def-attr>
    <def-attr n="a_pron">
      <attr-item tags="Pron"/>
      <attr-item tags="Pron.Rel"/>
      <attr-item tags="Pron.Indef"/>
      <attr-item tags="Pron.Dem"/>
      <attr-item tags="Pron.Pers"/>
      <attr-item tags="prn"/>
      <attr-item tags="prn.itg"/>
      <attr-item tags="prn.ref"/>
    </def-attr>
    <def-attr n="a_det">
      <attr-item tags="det"/> 
      <attr-item tags="det.emph"/>
      <attr-item tags="det.dem"/>
      <attr-item tags="det.itg"/>
      <attr-item tags="det.qnt"/>
      <attr-item tags="det.pos"/>
    </def-attr>
    <def-attr n="lettercase">
      <attr-item tags="fixedcase"/>
    </def-attr>
    <def-attr n="a_conj">
      <attr-item tags="CC"/>
      <attr-item tags="CS"/>
      <attr-item tags="cnjcoo"/>
      <attr-item tags="cnjcoo.clb"/>
      <attr-item tags="cnjsub"/>
    </def-attr>
    <def-attr n="a_count">
      <attr-item tags="Coll"/>
      <attr-item tags="unc"/>
    </def-attr>
    <def-attr n="a_nom_all">
      <attr-item tags="ABBR"/>
      <attr-item tags="N"/>
      <attr-item tags="N.Prop"/>
      <attr-item tags="N.Prop.Sur"/>
      <attr-item tags="N.Prop.Plc"/>
      <attr-item tags="N.Prop.Org"/>
      <attr-item tags="N.Prop.Mal"/>
      <attr-item tags="N.Prop.Fem"/>
      <attr-item tags="N.Prop.Ani"/>
      <attr-item tags="N.Prop.Attr"/>
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
      <attr-item tags="np"/>
      <attr-item tags="np.top"/>
      <attr-item tags="np.attr"/>
    </def-attr>
    <def-attr n="a_nom">
      <attr-item tags="n"/>
      <attr-item tags="n.acr"/>
      <attr-item tags="np"/>
      <attr-item tags="np.top"/>
      <attr-item tags="np.attr"/>
    </def-attr>
    <def-attr n="a_rel">
      <attr-item tags="Refl"/>
      <attr-item tags="ref"/>
      <attr-item tags="res" c="Reciprocal"/>
    </def-attr>
    <def-attr n="a_abess">
      <attr-item tags="VAbess"/>
    </def-attr>
    <def-attr n="voice">
      <attr-item tags="pass"/>
    </def-attr>
    <def-attr n="animacy">
      <attr-item tags="impers"/>
      <attr-item tags="pers"/>
    </def-attr>
    <def-attr n="trans">
      <attr-item tags="TV"/>
      <attr-item tags="IV"/>
    </def-attr>
    <def-attr n="actio">                                       <!--TODO: what's the category name?-->
      <attr-item tags="Actio"/>
    </def-attr>
    <def-attr n="a_caus">                                      <!--TODO: what's the category name?-->
      <attr-item tags="caus"/>
    </def-attr>
    <def-attr n="case">
      <attr-item tags="Nom"/>
      <attr-item tags="Acc"/>
      <attr-item tags="Gen"/>
      <attr-item tags="Com"/>
      <attr-item tags="Ess"/>
      <attr-item tags="Ill"/>
      <attr-item tags="Loc"/>
      <attr-item tags="Ine"/>
      <attr-item tags="Ela"/>
      <attr-item tags="nom"/>
      <attr-item tags="acc"/>
      <attr-item tags="gen"/>
      <attr-item tags="com"/>
      <attr-item tags="ess"/>
      <attr-item tags="ill"/>
      <attr-item tags="loc"/>
      <attr-item tags="ine"/>
      <attr-item tags="ela"/>
    </def-attr>
    <def-attr n="gen-case">
      <attr-item tags="gen"/>
    </def-attr>
    <def-attr n="pers">
      <attr-item tags="p1"/>
      <attr-item tags="p2"/>
      <attr-item tags="p3"/>
    </def-attr>
    <def-attr n="grau">
      <attr-item tags="ord.posi"/>
      <attr-item tags="ord.comp"/>
      <attr-item tags="ord.sup"/>
      <attr-item tags="Comp"/>
      <attr-item tags="Superl"/>
      <attr-item tags="posi"/>
      <attr-item tags="comp"/>
      <attr-item tags="sup"/>
    </def-attr>
    <def-attr n="gen">
      <attr-item tags="m"/>
      <attr-item tags="f"/>
      <attr-item tags="mf"/>
      <attr-item tags="nt"/>
      <attr-item tags="GD"/>
      <attr-item tags="GD_pers"/>
    </def-attr>
    <def-attr n="nbr">
      <attr-item tags="Sg"/>
      <attr-item tags="Du"/>
      <attr-item tags="Pl"/>
      <attr-item tags="sg"/>
      <attr-item tags="du"/>
      <attr-item tags="pl"/>
      <attr-item tags="ND"/>
      <attr-item tags="sp"/>
    </def-attr>
    <def-attr n="art">
      <attr-item tags="def"/>
      <attr-item tags="ind"/>
      <attr-item tags="DD"/>
    </def-attr>
    <def-attr n="temps">
      <attr-item tags="Prs"/>
      <attr-item tags="Prt"/>
      <attr-item tags="pres"/>
      <attr-item tags="pret"/>
      <attr-item tags="Inf"/>
      <attr-item tags="inf"/>
      <attr-item tags="Imprt"/>
      <attr-item tags="imp"/>
      <attr-item tags="PrfPrc"/>
      <attr-item tags="pp"/>
      <attr-item tags="TD"/>
    </def-attr>
    <def-attr n="neg">
      <attr-item tags="ConNeg"/>
      <attr-item tags="Neg"/>
    </def-attr>
    <def-attr n="mode">
      <attr-item tags="Qst"/>
    </def-attr>
    <def-attr n="modality">
      <attr-item tags="Ind"/>
      <attr-item tags="Cond"/>
      <attr-item tags="Cond2"/>
      <attr-item tags="Cond3"/>
      <attr-item tags="Pot"/>
    </def-attr>
    <def-attr n="syn_label">
      <attr-item tags="@→A"/>
      <attr-item tags="@A←"/>
      <attr-item tags="@←ADVL"/>
      <attr-item tags="@→ADVL"/>
      <attr-item tags="@ADVL"/>
      <attr-item tags="@ADVL←"/>
      <attr-item tags="@ADVL→"/>
      <attr-item tags="@ADVL→CS"/>
      <attr-item tags="@ADVL←OBJ"/>
      <attr-item tags="@ADVL→SUBJ"/>
      <attr-item tags="@APP"/>
      <attr-item tags="@APP-ADVL←"/>
      <attr-item tags="@APP-N←"/>
      <attr-item tags="@APP-Num←"/>
      <attr-item tags="@APP-Pron←"/>
      <attr-item tags="@APP→Pron"/>
      <attr-item tags="@→CC"/>
      <attr-item tags="@CNP"/>
      <attr-item tags="@COMP-CS←"/>
      <attr-item tags="@CVP"/>
      <attr-item tags="@-F←ADVL"/>
      <attr-item tags="@-FADVL"/>
      <attr-item tags="@-FADVL→"/>
      <attr-item tags="@-FAUXV"/>
      <attr-item tags="@\+FAUXV"/>
      <attr-item tags="@+FAUXV"/>
      <attr-item tags="@-FMAINV"/>
      <attr-item tags="@\+FMAINV"/>
      <attr-item tags="@+FMAINV"/>
      <attr-item tags="@-F←OBJ"/>
      <attr-item tags="@-FOBJ"/>
      <attr-item tags="@-FOBJ→"/>
      <attr-item tags="@-F←OPRED"/>
      <attr-item tags="@-FOPRED→"/>
      <attr-item tags="@-F←SPRED"/>
      <attr-item tags="@-FSPRED→"/>
      <attr-item tags="@-FSUBJ→"/>
      <attr-item tags="@HAB"/>
      <attr-item tags="@HNOUN"/>
      <attr-item tags="@INTERJ"/>
      <attr-item tags="@→N"/>
      <attr-item tags="@N←"/>
      <attr-item tags="@N"/>
      <attr-item tags="@→Num;"/>
      <attr-item tags="@→Num"/>
      <attr-item tags="@Num←"/>
      <attr-item tags="@←OBJ"/>
      <attr-item tags="@OBJ"/>
      <attr-item tags="@OBJ→"/>
      <attr-item tags="@OBJ→SPRED"/>
      <attr-item tags="@-OPRED→"/>
      <attr-item tags="@←OPRED"/>
      <attr-item tags="@OPRED"/>
      <attr-item tags="@OPRED→"/>
      <attr-item tags="@→P"/>
      <attr-item tags="@P←"/>
      <attr-item tags="@PCLE"/>
      <attr-item tags="@←PPRED"/>
      <attr-item tags="@PPRED"/>
      <attr-item tags="@→Pron"/>
      <attr-item tags="@Pron←"/>
      <attr-item tags="@-SPRED→"/>
      <attr-item tags="@←SPRED"/>
      <attr-item tags="@SPRED"/>
      <attr-item tags="@SPRED→"/>
      <attr-item tags="@SPRED←OBJ"/>
      <attr-item tags="@←SUBJ"/>
      <attr-item tags="@SUBJ"/>
      <attr-item tags="@SUBJ→"/>
      <attr-item tags="@SUBJ←ADVL"/>
      <attr-item tags="@SUBJ←OBJ"/>
      <attr-item tags="@VOC"/>
      <attr-item tags="@X"/>
    </def-attr>
  </section-def-attrs>
  
  <section-def-vars>
    <def-var n="n_nbr"          c="noun number"/>
    <def-var n="pron_gen"       c="pronoun gender"/>
    <def-var n="pron_nbr"       c="pronoun number"/>
    <def-var n="pron_pers"      c="pronoun person (esp. for reflexive)"/>
    <def-var n="pre-nom"        c="lu's before nom-lu in nominal chunk"/>
    <def-var n="post-nom"       c="lu's after nom-lu in nominal chunk (only used in 'den som V cmp')"/>
    <def-var n="pre-verb"       c="lu's before verb-lu in verbal chunk (only compounds for now)"/>
    <def-var n="defnes"         c="definiteness (noun, adj)"/>
    <def-var n="c_name"         c="chunk name"/>
    <def-var n="tmp"            c="temporary variable"/>
    <def-var n="c_gen"          c="chunk gender"/>
    <def-var n="c_nbr"          c="chunk number"/>
    <def-var n="c_def_pos"      c="chunk defnes tag position"/>
    <def-var n="c_syn"          c="chunk syn_label"/>
    <def-var n="c_animacy"      c="chunk animacy (pers, impers)"/>
    <def-var n="caseFirstWord"  c="typographic case of first word"/>
    <def-var n="caseprep"       c="nob preposition (whole chunk) based on sme case"/>
    <def-var n="previous-nhead" c="lemh of the previous NP chunk (or special values like NUM)" v=""/>
  </section-def-vars>

  <section-def-lists>
    <def-list n="infinite_temps">
      <list-item v="&lt;Inf&gt;"/>
      <list-item v="&lt;inf&gt;"/>
      <list-item v="&lt;PrfPrc&gt;"/>
      <list-item v="&lt;pp&gt;"/>
    </def-list>

    <def-list n="animate_nonagent-verbs" c="Passive versions of these have 'pers' tag on 'bli', else 'impers',
                                            in order to make the inserted subject pronoun animate.">
      <!-- From newspaper corpus, grep 'h[au]n ble'|sort|uniq -c|sort -n, then filter out 'det ble' hits etc.: -->
      <list-item v="pågripe"/>
      <list-item v="arrestere"/>
      <list-item v="drepe"/>
      <list-item v="hente"/>
      <list-item v="spørre"/>
      <list-item v="dømme"/>
      <list-item v="stoppe"/>
      <list-item v="velge"/>
      <list-item v="løslate"/>
      <list-item v="kåre"/>
      <list-item v="frakte"/>
      <list-item v="påføre"/>
      <list-item v="tvinge"/>
      <list-item v="påkjøre"/>
      <list-item v="overraske"/>
      <list-item v="anmelde"/>
      <list-item v="utnevne"/>
      <list-item v="skade"/>
      <list-item v="intervjue"/>
      <list-item v="be"/>
      <list-item v="utvise"/>
      <list-item v="bytte"/>
      <list-item v="anklage"/>
      <list-item v="operere"/>
      <list-item v="fly"/>
      <list-item v="ansette"/>
      <list-item v="styrte"/>
      <list-item v="sparke"/>
      <list-item v="sikte"/>
      <list-item v="nekte"/>
      <list-item v="konfrontere"/>
      <list-item v="såre"/>
      <list-item v="sjokkere"/>
      <list-item v="redde"/>
      <list-item v="presse"/>
      <list-item v="gjenvelge"/>
      <list-item v="frikjenne"/>
      <list-item v="fengsle"/>
      <list-item v="tildele"/>
      <list-item v="forsinke"/>
      <list-item v="utestenge"/>
      <list-item v="overmanne"/>
      <list-item v="oppringe"/>
      <list-item v="ringe"/>
      <list-item v="kontakte"/>
      <list-item v="filme"/>
      <list-item v="fange"/>
      <list-item v="bære"/>
      <list-item v="anrope"/>
      <list-item v="sykemelde"/>
      <list-item v="knivstikke"/>
      <list-item v="henrette"/>
      <list-item v="flytte"/>
      <list-item v="erstatte"/>
      <list-item v="banke"/>
      <list-item v="avhøre"/>
      <list-item v="vekke"/>
      <list-item v="overkjøre"/>
      <list-item v="nominere"/>
      <list-item v="lure"/>
      <list-item v="innkalle"/>
      <list-item v="idømme"/>
      <list-item v="hylle"/>
      <list-item v="frata"/>
      <list-item v="etterforske"/>
      <list-item v="ekskludere"/>
      <list-item v="bøtelegge"/>
      <list-item v="bortføre"/>
      <list-item v="beskyte"/>
      <list-item v="begrave"/>
      <list-item v="baktale"/>
      <list-item v="varetektsfengsle"/>
      <list-item v="utstøte"/>
      <list-item v="utlevere"/>
      <list-item v="utelate"/>
      <list-item v="transportere"/>
      <list-item v="smitte"/>
      <list-item v="skade"/>
      <list-item v="rane"/>
      <list-item v="provosere"/>
      <list-item v="plassere"/>
      <list-item v="overlevere"/>
      <list-item v="overbevise"/>
      <list-item v="omringe"/>
      <list-item v="myrde"/>
      <list-item v="irritere"/>
      <list-item v="involvere"/>
      <list-item v="invitere"/>
      <list-item v="innhente"/>
      <list-item v="imponere"/>
      <list-item v="gjenkjenne"/>
      <list-item v="geleide"/>
      <list-item v="forkjøle"/>
      <list-item v="dytte"/>
      <list-item v="deportere"/>
      <list-item v="binde"/>
      <list-item v="blende"/>
      <list-item v="avsette"/>
      <list-item v="avlytte"/>
      <list-item v="avbryte"/>
      <list-item v="avbilde"/>
      <list-item v="anholde"/>
      <!-- Newspaper-animate_nonagent-verbs are so depressing, here are some happier ones: -->
      <list-item v="forundre"/>
      <list-item v="elske"/>
      <list-item v="pålegge"/>
      <list-item v="fotografere"/>
      <list-item v="inspirere"/>
      <list-item v="klemme"/>
      <list-item v="kysse"/>
      <list-item v="rose"/>
      <list-item v="oppmuntre"/>
      <list-item v="frigjøre"/>
      <list-item v="unnskylde"/>
      <list-item v="forlate"/>
      <list-item v="beklage"/>
      <list-item v="savne"/>
    </def-list>

    <def-list n="ill-NIL-verbs" c="We add the 'ill-NIL' tag to verb chunks with these verbs,
                                   use that tag in t2x to remove the caseprep.PR.ill chunk
                                   TODO: use nob/tl verb instead?">
      <list-item v="oahpahit"/>
      <list-item v="oččodit"/>
      <list-item v="guoskat"/>
      <list-item v="joavdat"/>
      <list-item v="deaivat"/>
      <list-item v="riŋget"/>
      <list-item v="čuojahit"/>
      <list-item v="liikot"/>
    </def-list>
    <def-list n="ill-på-verbs" c="See 'ill-NIL-verbs' above.
                                  Speech verbs, emotional(?) verbs">
      <list-item v="čállit"/>
      <list-item v="lohkat"/>
      <list-item v="hállat"/>
      <list-item v="suhttat"/>
      <list-item v="luohttit"/>
      <list-item v="dorvvastit"/>
      <list-item v="jáhkkit"/>
      <list-item v="geahččat"/>
      <list-item v="guovlat"/>
      <list-item v="báhcit"/>
      <list-item v="čoalkalit"/>
    </def-list>
    <def-list n="ill-av-verbs" c="See 'ill-NIL-verbs' above.
                                  TODO: Add all lexicalised Der_halla verbs (with illative agents)
                                  (Verbs tagged Der_halla are added in out_verb)">
      <list-item v="fillehallat"/>
      <list-item v="borahallat"/>
      <list-item v="gáskkáhallat"/>
      <list-item v="dorohallat"/>
      <list-item v="bovttáhallat"/>
      <list-item v="bealkkáhallat"/>
      <list-item v="rissehallat"/>
      <list-item v="gávnnahallat"/>
      <list-item v="oainnahallat"/>
      <list-item v="vuojáhallat"/>
    </def-list>
    <def-list n="loc-for-verbs" c="See 'ill-NIL-verbs' above.">
      <list-item v="ballat"/>
      <list-item v="nohkkot"/>
      <list-item v="váruhit"/>
    </def-list>
    <def-list n="loc-om-verbs" c="See 'ill-NIL-verbs' above.">
      <list-item v="beroštit"/>
    </def-list>
    <def-list n="loc-fra-verbs" c="See 'ill-NIL-verbs' above.">
      <list-item v="gullat" c="Problematic; Leat go gullan sus alddis? vs Go gullen sámegiela dien mátkkis."/>
      <list-item v="beassat" c="Mihttomearri lea beassat hálddašanguovvlus."/>
      <list-item v="beassat" c="Mihttomearri lea beassat hálddašanguovvlus."/>
      <list-item v="boahtit" c="Mun boađán gávpogis."/>
      <list-item v="fárret" c="… juogo fárret sámi gilážis vai besset eallit homofiilan."/>
    </def-list>
    <def-list n="loc-om" c="Locative noun phrases default to 'på' unless in this or next list (or are np.top)">
      <list-item v="kveld"/>
      <list-item v="dag"/>
      <list-item v="morgen"/>
      <list-item v="natt"/>
    </def-list>
    <def-list n="loc-av" c="Locative noun phrases default to 'på' unless they're in this list (or are np.top)">
      <list-item v="slekt"/>
    </def-list>    
    <def-list n="loc-i" c="Locative noun phrases default to 'på' unless in this list (or are np.top)">
      <list-item v="skuff"/>
      <list-item v="klasse"/>
      <list-item v="land"/>
      <list-item v="utland"/>
      <list-item v="speil"/>
      <list-item v="begynnelse"/>
      <list-item v="oppfatning"/>
      <list-item v="sammenheng"/>
      <list-item v="forbindelse"/>
      <list-item v="hus"/>
      <list-item v="by"/>
      <list-item v="liv"/>
      <list-item v="dokument"/>
      <list-item v="lov"/>
      <list-item v="bruk"/>
      <list-item v="allmenning"/>
      <list-item v="krukke"/>
      <list-item v="rom"/>
      <list-item v="mellomrom"/>
      <list-item v="tidsrom"/>
      <list-item v="periode"/>
      <list-item v="dråpe"/>
      <list-item v="hjerte"/>
      <list-item v="bygd"/>
      <list-item v="hage"/>
      <list-item v="stue"/>
      <list-item v="seng"/>
      <list-item v="skap"/>
      <list-item v="vask"/>
      <list-item v="gamme"/>
      <list-item v="navn"/>
      <list-item v="januar"/>
      <list-item v="februar"/>
      <list-item v="mars"/>
      <list-item v="april"/>
      <list-item v="mai"/>
      <list-item v="juni"/>
      <list-item v="juli"/>
      <list-item v="august"/>
      <list-item v="september"/>
      <list-item v="oktober"/>
      <list-item v="november"/>
      <list-item v="desember"/>
    </def-list>
    <def-list n="loc-på" c="Proper place nouns (np.top) get preposition 'i' unless they're in this list.">
      <list-item v="Vestlandet"/>
      <list-item v="Østlandet"/>
      <list-item v="Gjøvik"/>
      <list-item v="Lillehammer"/>
      <list-item v="Hamar"/>
      <list-item v="Bygdøy"/>
      <list-item v="Andøya"/>
      <list-item v="Sicilia"/>
      <list-item v="Cuba"/>
      <list-item v="Grønland"/>
      <list-item v="Filippinene"/>
      <list-item v="Island"/>
      <list-item v="Svalbard"/>
      <list-item v="Hovedøya"/>
      <list-item v="Kreta"/>
      <list-item v="Kvaløya"/>
      <list-item v="Madagaskar"/>
      <list-item v="Hitra"/>
      <list-item v="Hidra"/>
      <list-item v="Hispaniola"/>
      <list-item v="Island"/>
      <list-item v="mandag"/>
      <list-item v="tirsdag"/>
      <list-item v="onsdag"/>
      <list-item v="torsdag"/>
      <list-item v="fredag"/>
      <list-item v="lørdag"/>
      <list-item v="søndag"/>
      <list-item v="dag"/>
      <list-item v="øy"/>
      <list-item v="topp"/>
      <list-item v="kjøkken"/>
    </def-list>
    <def-list n="loc-av-head" c="Locative noun phrases default to 'på', unless they modify nouns in this list">
      <list-item v="del"/>
      <list-item v="NUMERAL"/>      <!-- special value set by numerals, see NUMERAL rule -->
    </def-list>
    <def-list n="ess-NIL" c="Essive noun phrases default to 'som' unless in this list">
      <list-item v="del"/>
    </def-list>
    <def-list n="ill-i" c="Illative noun phrases default to 'til' unless in this list">
      <list-item v="del"/>
    </def-list>
    <def-list n="ill-på" c="Illative noun phrases default to 'til' unless in this list">
      <list-item v="ferie"/>
      <list-item v="golv"/>
      <list-item v="samisk"/>
      <list-item v="norsk"/>
      <list-item v="nynorsk"/>
      <list-item v="bokmål"/>
      <list-item v="engelsk"/>
    </def-list>
    <def-list n="ill-NIL" c="Illative noun phrases default to 'til' unless in this list">
      <list-item v="feil"/>
    </def-list>

    <def-list n="no-gen-after-prop" c="If a noun in this list is preceded by a prop.gen, remove the gen from the prop">
      <list-item v="skole"/>
      <list-item v="ungdomssskole"/>
      <list-item v="by"/>
      <list-item v="kommune"/>
      <list-item v="bru"/>
      <list-item v="bro"/>
    </def-list>
    <def-list n="noun.pseudo-prop"
              c="Nouns that act proper (indefinite in the singular, no determiner)">
      <list-item v="mor"/>
      <list-item v="far"/>
      <list-item v="bestemor"/>
      <list-item v="bestefar"/>
      <list-item v="velkommen"/>
      <list-item v="januar"/>
      <list-item v="februar"/>
      <list-item v="mars"/>
      <list-item v="april"/>
      <list-item v="mai"/>
      <list-item v="juni"/>
      <list-item v="juli"/>
      <list-item v="august"/>
      <list-item v="september"/>
      <list-item v="oktober"/>
      <list-item v="november"/>
      <list-item v="desember"/>
    </def-list>
  </section-def-lists>

  <section-def-macros>
    <def-macro n="set_caseFirstWord" npar="1"
               c="Set the typographic case to be carried by the chunk.
                  - if argument is _not_ a proper noun: caseFirstWord is the case of the lemma, and the lemma gets lowercase.
                  - if argument _is_ a proper noun: caseFirstWord is lowercase, and lemma stays unchanged.
                  
                  (This means that if the sentence starts with a proper noun, and we insert eg. a preposition before that,
                   the preposition won't get capitalised in t2x. We _could_ circumvent this by having a global variable
                   'FirstWordSeen' that is set to false on periods and true for all other lexical units, but this is low priority.)">
      <let><var n="caseFirstWord"/><lit v="aa"/></let>
      <choose><when>
        <test><not><or>
          <begins-with><clip pos="1" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with>
          <equal><clip pos="1" side="tl" part="lettercase"/><lit-tag v="fixedcase"/></equal>
        </or></not></test>
        <let><var n="caseFirstWord"/><get-case-from pos="1"><lit v="aa"/></get-case-from></let>
        <modify-case><clip pos="1" side="tl" part="lemh"/><lit v="aa"/></modify-case>
      </when></choose>
    </def-macro>

    <def-macro n="switch_cases" npar="2"
               c="Simply switch the typographic cases (upper/lower/capital) of the two arguments.">
      <let><var n="tmp"/><get-case-from pos="1"><clip pos="1" side="tl" part="lemh"/></get-case-from></let>
      <let><clip pos="1" side="tl" part="lemh"/><get-case-from pos="2"><clip pos="1" side="tl" part="lemh"/></get-case-from></let>
      <modify-case><clip pos="2" side="tl" part="lemh"/><var n="tmp"/></modify-case>
    </def-macro>
    
    <def-macro n="set_caseprep" npar="1"
               c="arg.1: noun, pronoun
                  -----
                  First attempt (may be changed in later stages).">
      <let>
        <var n="caseprep"/><lit v=""/>
      </let>
      <choose>
        <when>
          <test><equal><clip pos="1" side="sl" part="case"/><lit-tag v="Loc"/></equal></test>
          <let>
            <var n="caseprep"/><lit v="på"/>
          </let>
          <choose c="Exceptions to the locative→på rule:">
            <when>
              <test><or>
                <in><var n="previous-nhead"/><list n="loc-av-head"/></in>
                <in><clip pos="1" side="tl" part="lemh"/><list n="loc-av"/></in>
              </or></test>
              <let>
                <var n="caseprep"/><lit v="av"/>
              </let>
            </when>
            <when>
              <test><or>
                <in><clip pos="1" side="tl" part="lemh"/><list n="loc-i"/></in>
                <and>
                  <equal><clip pos="1" side="tl" part="a_nom"/><lit-tag v="np.top"/></equal>
                  <not><in><clip pos="1" side="tl" part="lemh"/><list n="loc-på"/></in></not>
                </and>
              </or></test>
              <let>
                <var n="caseprep"/><lit v="i"/>
              </let>
            </when>
            <when>
              <test><in><clip pos="1" side="tl" part="lemh"/><list n="loc-om"/></in></test>
              <let>
                <var n="caseprep"/><lit v="om"/>
              </let>
            </when>
            <when c="Habitive, or reflexive of habitive">
              <test><or>
                <equal><clip pos="1" side="tl" part="syn_label"/><lit-tag v="@HAB"/></equal>
                <and>
                  <equal><clip pos="1" side="sl" part="a_pron"/><lit-tag v="Pron"/></equal>
                  <equal><clip pos="1" side="sl" part="a_rel"/><lit-tag v="Refl"/></equal>
                  <equal><clip pos="1" side="tl" part="lemh"/><lit v="selv"/></equal>
                </and>
              </or></test>
              <let>
                <var n="caseprep"/><lit v=""/>
              </let>
            </when>
          </choose>
        </when>
        <when>
          <test><equal><clip pos="1" side="sl" part="case"/><lit-tag v="Com"/></equal></test>
          <let>
            <var n="caseprep"/><lit v="med"/>
          </let>
        </when>
        <when>
          <test><equal><clip pos="1" side="sl" part="case"/><lit-tag v="Ess"/></equal></test>
          <let>
            <var n="caseprep"/><lit v="som"/>
          </let>
          <choose><when>
            <test><in><clip pos="1" side="tl" part="lemh"/><list n="ess-NIL"/></in></test>
            <let>
              <var n="caseprep"/><lit v=""/>
            </let>
          </when></choose>
        </when>
        <when>
          <test><equal><clip pos="1" side="sl" part="case"/><lit-tag v="Ill"/></equal></test>
          <let>
            <var n="caseprep"/><lit v="til"/>
          </let>
          <choose><when>
            <test><in><clip pos="1" side="tl" part="lemh"/><list n="ill-på"/></in></test>
            <let>
              <var n="caseprep"/><lit v="på"/>
            </let>
          </when></choose>
          <choose><when>
            <test><in><clip pos="1" side="tl" part="lemh"/><list n="ill-i"/></in></test>
            <let>
              <var n="caseprep"/><lit v="i"/>
            </let>
          </when></choose>
          <choose><when>
            <test><in><clip pos="1" side="tl" part="lemh"/><list n="ill-NIL"/></in></test>
            <let>
              <var n="caseprep"/><lit v=""/>
            </let>
          </when></choose>
        </when>
        <when>
          <test><equal><clip pos="1" side="sl" part="case"/><lit-tag v="Gen"/></equal></test>
          <choose>
            <when>
              <test><or>
                <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@→N"/></equal>
                <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@→A"/></equal>
                <equal><clip pos="1" side="tl" part="a_det"/><lit-tag v="det.pos"/></equal>
                <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@←SPRED"/></equal>
              </or></test>
              <let>
                <var n="caseprep"/><lit v=""/>                <!--sin-->
              </let>
            </when>
            <otherwise c="Not a modifier: neither prep nor genitive case">
              <let><var n="caseprep"/><lit v=""/></let>
              <choose><when>
                <test><equal><clip pos="1" side="tl" part="case"/><lit-tag v="gen"/></equal></test>
                <let><clip pos="1" side="tl" part="case"/><lit v=""/></let>
              </when></choose>
            </otherwise>
          </choose>
        </when>
      </choose>

      <let>
        <var n="previous-nhead"/>
        <clip pos="1" side="tl" part="lemh"/>
      </let>

      <!-- Now output it: -->
      <choose>
        <when>
          <test><not><equal><var n="caseprep"/><lit v=""/></equal></not></test>
          <let>
            <var n="caseprep"/>
            <concat>
              <lit v="^"/>
              <lit v="caseprep"/>
              <lit-tag v="PR"/>
              <clip pos="1" side="tl" part="case"/>
              <lit v="{^"/>
              <var n="caseprep"/>
              <lit-tag v="pr"/>
              <lit v="$}$ "/>
            </concat>
          </let>
        </when>
      </choose>
    </def-macro>
    
    <def-macro n="modify_pron_case" npar="1"
               c="arg.1: Pron (which might end up as a nob determiner)
                  -----
                  If pron is the chunk head, make sure to call this after set_caseprep!
                  - Personal pronouns can only be nom or acc (note: @HAB / @-FSUBJ→ / @-FOBJ→ => nom),
                  - Demonstrative and indefinites can only be gen in nob,
                  - det.pos (personal genitives) have no case, but this is handled in transfer rules.">
      <choose>
        <when>
          <test><equal><clip pos="1" side="sl" part="a_pron"/><lit-tag v="Pron.Pers"/></equal></test>
          <choose>
            <when>
              <test><or>
                <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@HAB"/></equal>
                <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@-FSUBJ→"/></equal>
                <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@-FOBJ→"/></equal>
              </or></test>
              <let><clip pos="1" side="tl" part="case"/><lit-tag v="nom"/></let>
            </when>
            <when>
              <test><not>
                <or>
                  <equal><clip pos="1" side="sl" part="case"/><lit-tag v="Nom"/></equal>
                  <equal><clip pos="1" side="sl" part="case"/><lit-tag v="Gen"/></equal>
                </or>
              </not></test>
              <let><clip pos="1" side="tl" part="case"/><lit-tag v="acc"/></let>
            </when>
          </choose>
        </when>
        <otherwise>
          <choose><when>
            <test>
              <not><equal><clip pos="1" side="sl" part="case"/><lit-tag v="Gen"/></equal></not>
            </test>
            <let><clip pos="1" side="tl" part="case"/><lit v=""/></let>
          </when></choose>
        </otherwise>
      </choose>
    </def-macro>
    
    <def-macro n="set_pron_gen_nbr_art" npar="1"
               c="arg.1: noun (or, the lu we want to base pron/det gen/nbr on)
                  -----
                  Note: lone pronouns/determiners just keep GD/ND, this might change
                  in interchunk (postchunk cleans it up if not).">
      <let><var n="pron_nbr"/><clip pos="1" side="tl" part="nbr"/></let>
      <choose><when c="default plural if no nbr">
        <test><equal><var n="pron_nbr"/><lit v=""/></equal></test>
        <let><var n="pron_nbr"/><lit-tag v="pl"/></let>
      </when></choose>
      <choose>
        <when>
          <test>
            <equal><var n="pron_nbr"/><lit-tag v="pl"/></equal>
          </test>
          <let><var n="pron_gen"/><lit v=""/></let>
        </when>
        <otherwise>
          <let><var n="pron_gen"/><clip pos="1" side="tl" part="gen"/></let>
          <choose><when>
            <test><equal><var n="pron_gen"/><lit v=""/></equal></test>
            <let><var n="pron_gen"/><lit-tag v="m"/></let>
          </when></choose>
        </otherwise>
      </choose>
      <choose><when>
          <test><equal><clip pos="1" side="tl" part="art"/><lit v="DD"/></equal></test>
          <let><clip pos="1" side="tl" part="art"/><lit-tag v="3"/></let>
      </when></choose>
    </def-macro>
    
    <def-macro n="set_c_gen_nbr" npar="1"
               c="Make sure we have GD or ND if no gen or num given">
      <let><var n="c_gen"/><clip pos="1" side="tl" part="gen"/></let>
      <let><var n="c_nbr"/><clip pos="1" side="tl" part="nbr"/></let>
      <choose><when>
        <test><equal><var n="c_gen"/><lit v=""/></equal></test>
        <let><var n="c_gen"/><lit-tag v="GD"/></let>
      </when></choose>
      <choose><when>
        <test><equal><var n="c_nbr"/><lit v=""/></equal></test>
        <let><var n="c_nbr"/><lit-tag v="ND"/></let>
      </when></choose>
    </def-macro>

    <def-macro n="copy_syn_label" npar="2"
               c="arg.1: might want a syn_label, arg.2: might have syn_label
                  -----
                  Used in compounds, where typically the left part gets the syn_label while
                  the right one needs it.">
      <choose><when>
        <test><equal><clip pos="1" side="sl" part="syn_label"/><lit v=""/></equal></test>
        <let>
          <clip pos="1" side="sl" part="tags"/>
          <concat>
            <clip pos="1" side="sl" part="tags"/>
            <clip pos="2" side="sl" part="syn_label"/>
          </concat>
        </let>
      </when></choose>
    </def-macro>

    <def-macro n="modify_nomcmp_nbr_art" npar="1"
               c="arg.1: non-final noun in a compound
                  -----
                  The sp ones in nob.dix never have defnes tags.
                  Regular nouns are always sg.ind when non-final in compounds.
                  Bidix often does not supply defnes/number, making clip fail; in that case, append to tags">
      <choose>
        <when c="Do nothing for proper nouns">
          <test><begins-with><clip pos="1" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with></test>
        </when>
        <when>
          <test><equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="sp"/></equal></test>
          <let><clip pos="1" side="tl" part="art"/><lit v=""/></let>
        </when>
        <otherwise>
          <let><clip pos="1" side="tl" part="nbr"/><concat><lit-tag v="sg"/></concat></let>
          <let><clip pos="1" side="tl" part="art"/><concat><lit-tag v="ind"/></concat></let>
          <choose><when>
            <test><equal><clip pos="1" side="tl" part="nbr"/><lit v=""/></equal></test>
            <let><clip pos="1" side="tl" part="tags"/><concat><clip pos="1" side="tl" part="tags"/><lit-tag v="sg"/></concat></let>
          </when></choose>
          <choose><when>
            <test><equal><clip pos="1" side="tl" part="art"/><lit v=""/></equal></test>
            <let><clip pos="1" side="tl" part="tags"/><concat><clip pos="1" side="tl" part="tags"/><lit-tag v="ind"/></concat></let>
          </when></choose>
        </otherwise>
      </choose>
    </def-macro>

    <def-macro n="set_defnes" npar="1"
               c="arg.1: noun/adj, with syn_label
                  -----
                  Default to indefinite, guess definite for certain GF's, genitives, ...
                  Locatives only indefinite in first position with leat
                  Adjectives given to this macro will be (predicative and) indefinite
                   (or do we ever get 'det er den røde.Def' here?)">
      <let><var n="defnes"/><lit-tag v="ind"/></let>
      <choose>
        <when>
          <test><and>
            <not><equal><clip pos="1" side="tl" part="a_count"/><lit-tag v="unc"/></equal></not>
            <not><and>
              <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></equal>
              <in caseless="yes"><clip pos="1" side="tl" part="lemh"/><list n="noun.pseudo-prop"/></in>
            </and></not>
            <equal><clip pos="1" side="tl" part="a_adj"/><lit v=""/></equal>
            <or>
              <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@OBJ→"/></equal>
              <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@HAB"/></equal>
              <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@SUBJ→"/></equal>
              <equal><clip pos="1" side="sl" part="case"/><lit-tag v="Gen"/></equal>
              <equal><clip pos="1" side="sl" part="case"/><lit-tag v="Loc"/></equal>
              <equal><clip pos="1" side="sl" part="case"/><lit-tag v="Ill"/></equal>
              <and>
                <equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></equal>
                <not><equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@←PPRED"/></equal></not>
                <not><equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@←SPRED"/></equal></not>
                <not><equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@←OPRED"/></equal></not>
                <not><equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@ADVL"/></equal></not>
                <not><equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@ADVL→"/></equal></not>
                <!-- syn_label!=@←ADVL conflicts with 'Son ii dáidde
                     jienastit Bargiidbellodaga(def)' but is necessary
                     for 'Doppe son orui vahku(ind)' -->
                <not><equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@←ADVL"/></equal></not>
                <not><equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@HNOUN"/></equal></not>
                <not><equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@X"/></equal></not>
                <not><equal><clip pos="1" side="sl" part="case"/><lit-tag v="Ess"/></equal></not>
                <not><equal><clip pos="1" side="sl" part="case"/><lit-tag v="Gen"/></equal></not>
              </and>
            </or></and>
          </test>
          <let><var n="defnes"/><lit-tag v="def"/></let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="set_defnes2" npar="2"
               c="arg.1: noun, arg.2: determiner. With 'det (adj) nom' the noun is definitely
                  * indefinite if the determiner is a possessive
                  * definite if it is a demonstrative
                  Otherwise, keep old defnes.
                  Assumes that clean_a_det has been called.">      
      <call-macro n="set_defnes"><with-param pos="1"/></call-macro>
      <choose>
	<when>
          <test><or>
            <equal><clip pos="2" side="tl" part="a_det"/><lit-tag v="det.pos"/></equal>
            <equal><clip pos="2" side="tl" part="a_det"/><lit-tag v="det.qnt"/></equal>
            <equal><clip pos="2" side="tl" part="a_det"/><lit-tag v="det.itg"/></equal>
            <equal><clip pos="2" side="tl" part="lemh"/><lit v="slik"/></equal>
          </or></test>
	  <let><var n="defnes"/><lit-tag v="ind"/></let>
	</when>
        <when>
          <test>
            <equal><clip pos="2" side="tl" part="a_det"/><lit-tag v="det.dem"/></equal>
          </test>
	  <let><var n="defnes"/><lit-tag v="def"/></let>
	</when>
      </choose>
    </def-macro>

    <def-macro n="clean_a_det" npar="1"
               c="arg.1: determiner. Change pron.gen into det.pos">
      <choose>
        <when>
          <test><and>
            <begins-with><clip pos="1" side="sl" part="a_pron"/><lit-tag v="Pron"/></begins-with>
            <equal><clip pos="1" side="sl" part="case"/><lit-tag v="Gen"/></equal>
          </and></test>
          <let><clip pos="1" side="tl" part="a_pron"/><lit-tag v="det.pos"/></let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="modify_adj_gen_nbr" npar="2"
               c="arg.1: noun, arg.1: adjective
                  -----
                  Number is only a feature of positive/pp adjectives in nob.
                  nob adj's never have m or f tags.">
      <choose>
        <when>
          <test>
            <or>
              <equal><clip pos="2" side="tl" part="temps"/><lit-tag v="pp"/></equal>
              <ends-with><clip pos="2" side="tl" part="grau"/><lit-tag v="posi"/></ends-with>
            </or>
          </test>
          <let><clip pos="2" side="tl" part="nbr"/><clip pos="1" side="tl" part="nbr"/></let>
          <choose>
            <when><test><not>
              <or>
                <equal><clip pos="2" side="tl" part="nbr"/><lit-tag v="sg"/></equal>
                <equal><clip pos="2" side="tl" part="nbr"/><lit-tag v="pl"/></equal>
              </or>
            </not></test>
            <let><clip pos="2" side="tl" part="nbr"/><lit-tag v="pl"/></let>
            </when>
          </choose>
        </when>
        <otherwise>
          <let><clip pos="2" side="tl" part="nbr"/><lit v=""/></let>
        </otherwise>
      </choose>
      <let>
        <clip pos="2" side="tl" part="gen"/><clip pos="1" side="tl" part="gen"/>
      </let>
      <choose>
        <when>
          <test>
            <not>
              <equal><clip pos="2" side="tl" part="gen"/><lit-tag v="nt"/></equal>
            </not>
          </test>
          <let><clip pos="2" side="tl" part="gen"/><lit-tag v="mf"/></let>
        </when>
      </choose>
    </def-macro>

    <def-macro n="set_c_syn" npar="1"
               c="We always have '3' as the defnes position in chunks, following chunk tag and syn_label, 
                  this macro just ensures that there _is_ a syn_label.">
      <let><var n="c_syn"/><clip pos="1" side="sl" part="syn_label"/></let>
      <choose>
        <when>
          <test><equal><var n="c_syn"/><lit v=""/></equal></test>
          <let><var n="c_syn"/><lit-tag v="@X"/></let>
        </when>
      </choose>
    </def-macro>

    <!-- Output macros: -->    
    <def-macro n="out_nom" npar="1"
               c="arg.1: noun
                  -----
                  ASSUMES THAT pre-nom, c_name, defnes AND caseFirstWord HAVE BEEN SET!
                  This macro is used to output nominal heads, possibly prepended by determiners
                  or adjectives (stored in pre-nom). It uses the case of the argument to find the
                  caseprep, outputting this before any det/adj's. The resulting chunk has the
                  syn_label of the nominal.
                  Removes number from proper noun.">
      <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
      <out><var n="caseprep"/></out>

      <call-macro n="set_c_gen_nbr"><with-param pos="1"/></call-macro>
      <call-macro n="set_c_syn"><with-param pos="1"/></call-macro>

      <append n="c_name"><lit v="nom"/></append>

      <choose>
        <when c="tl PoS is verb">
          <test><equal><clip pos="1" side="tl" part="a_verb"/><lit-tag v="vblex"/></equal></test>
          
          <out>
            <chunk namefrom="c_name" case="caseFirstWord"
                   c="The tag order corresponds with nouns, to make c_def_pos (e.g. on pre-nominals) work.">
              <tags>
                <tag><lit-tag v="SN"/></tag>
                <tag><var n="c_syn"/></tag>
                <tag><var n="defnes"/></tag>
                <tag><clip pos="1" side="sl" part="mode"/></tag>
                <tag><var n="c_gen"/></tag>
                <tag><var n="c_nbr"/></tag>
                <tag><clip pos="1" side="tl" part="case"/></tag>
                <tag><clip pos="1" side="tl" part="voice"/></tag>
                <tag><clip pos="1" side="tl" part="pers"/></tag>
                <tag><clip pos="1" side="tl" part="temps"/></tag>
              </tags>
              <var n="pre-nom"/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_pstv"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="voice"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </chunk>
          </out>
        </when>
        
        <when c="tl PoS is an adv (ie. V.Der2.Actor.N, but bidix changed lemma PoS to an adv)">
          <test><and>
            <equal><clip pos="1" side="tl" part="a_nom"/><lit v=""/></equal>
            <not><equal><clip pos="1" side="tl" part="a_adv"/><lit v=""/></equal></not>
          </and></test>

          <out>
            <chunk namefrom="c_name" case="caseFirstWord"
                   c="The tag order corresponds with nouns, to make c_def_pos (e.g. on pre-nominals) work.">
              <tags>
                <tag><lit-tag v="SN"/></tag>
                <tag><var n="c_syn"/></tag>
                <tag><var n="defnes"/></tag>
                <tag><clip pos="1" side="sl" part="mode"/></tag>
                <tag><var n="c_gen"/></tag>
                <tag><var n="c_nbr"/></tag>
                <tag><clip pos="1" side="tl" part="case"/></tag>
                <tag><clip pos="1" side="tl" part="voice"/></tag>
                <tag><clip pos="1" side="tl" part="pers"/></tag>
                <tag><clip pos="1" side="tl" part="temps"/></tag>
              </tags>
              <var n="pre-nom"/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_adv"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </chunk>
          </out>
        </when>
        <when c="tl PoS is an adj (ie. V.Der2.Actor.N, but bidix changed lemma PoS to an adj)
                 Just output posi.mf.sg.ind; TODO: different bidix verb pardef for these PoS changes.">
          <test><and>
            <equal><clip pos="1" side="tl" part="a_nom"/><lit v=""/></equal>
            <not><equal><clip pos="1" side="tl" part="a_adj"/><lit v=""/></equal></not>
          </and></test>

          <out>
            <chunk namefrom="c_name" case="caseFirstWord"
                   c="The tag order corresponds with nouns, to make c_def_pos (e.g. on pre-nominals) work.">
              <tags>
                <tag><lit-tag v="SN"/></tag>
                <tag><var n="c_syn"/></tag>
                <tag><var n="defnes"/></tag>
                <tag><clip pos="1" side="sl" part="mode"/></tag>
                <tag><var n="c_gen"/></tag>
                <tag><var n="c_nbr"/></tag>
                <tag><clip pos="1" side="tl" part="case"/></tag>
                <tag><clip pos="1" side="tl" part="voice"/></tag>
                <tag><clip pos="1" side="tl" part="pers"/></tag>
                <tag><clip pos="1" side="tl" part="temps"/></tag>
              </tags>
              <var n="pre-nom"/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_adj-pure"/>
                <lit-tag v="posi.mf.sg.ind"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </chunk>
          </out>
        </when>
        
        <otherwise c="Regular Noun=>Noun">
          <choose>
            <when>
              <test><or>
                <begins-with><clip pos="1" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with>
                <equal><clip pos="1" side="tl" part="a_nom"/><lit-tag v="n.acr"/></equal>
              </or></test>
              <let><clip pos="1" side="tl" part="nbr"/><lit v=""/></let>
              <let><var n="c_def_pos"/><lit v=""/></let>
            </when>
            <when c="RCmpnd → sg.ind.dash (split compounds)
                     eanan-(RCmpnd) ja luonddudoahpagiid => jord-(sg.ind) og naturfagord
                     NOTE: the dash tag is only defined for the sg.ind form of nouns in nob.dix (like cmp)
                     (as well as all numerals, where the change is handled in bidix)">
              <test><equal><clip pos="1" side="sl" part="a_cmp"/><lit-tag v="RCmpnd"/></equal></test>
              <choose><when>
                <test><equal><clip pos="1" side="tl" part="nbr"/><lit-tag v="pl"/></equal></test>
                <let><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></let>
              </when></choose>
              <let><var n="c_def_pos"/><lit-tag v="ind.dash"/></let>
              <let><clip pos="1" side="tl" part="gen-case"/><lit v=""/></let>
            </when>
            <otherwise>
              <let><var n="c_def_pos"/><lit-tag v="3"/></let>
            </otherwise>
          </choose>

          <out>
            <chunk namefrom="c_name" case="caseFirstWord">
              <tags>
                <tag><lit-tag v="SN"/></tag>
                <tag><var n="c_syn"/></tag>
                <tag><var n="defnes"/></tag>
                <tag><clip pos="1" side="sl" part="mode"/></tag>
                <tag><var n="c_gen"/></tag>
                <tag><var n="c_nbr"/></tag>
                <tag><clip pos="1" side="tl" part="case"/></tag>
                <tag><clip pos="1" side="tl" part="a_count"/></tag>
              </tags>
              <var n="pre-nom"/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_nom"/>
                <clip pos="1" side="tl" part="gen"/>
                <clip pos="1" side="tl" part="nbr"/>
                <var n="c_def_pos"/>
                <clip pos="1" side="tl" part="gen-case"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </chunk>
          </out>
        </otherwise>
      </choose>
    </def-macro>


    <def-macro n="out_verb" npar="1"
               c="arg.1: verb
                  -----
                  ASSUMES THAT pre-verb, c_name AND caseFirstWord HAVE BEEN SET!
                  This macro is used to output verbal heads, possibly prepended by compound parts
                  (stored in pre-verb).                  
                  This macro does the following, in this order:
                  - insert progressive aux if this is a progressive
                  - insert causative aux if we have a 'caus' tag
                  - insert passive aux if we see a 'pass' tag
                  - insert main predicate (tl PoS may be verb, adj, adv or n;
                              temps may have changed by the above operations)
                  - insert reflexive if we have a 'ref' tag
TODO: caseSecondWord ?">
  
      <choose c="Certain verbs interact with case prepositions, tag that here;
                 if so change preposition in t2x.
This tag is added to both main predicate chunks (except noun, TODO)
and to Conditional, Causative and and Passive chunks, just to make sure...">
        <when>
          <test><in caseless="yes"><clip pos="1" side="sl" part="lemh"/><list n="ill-NIL-verbs"/></in></test>
          <let><var n="caseprep"/><lit-tag v="ill-NIL"/></let>
        </when>
        <when>
          <test><in caseless="yes"><clip pos="1" side="sl" part="lemh"/><list n="ill-på-verbs"/></in></test>
          <let><var n="caseprep"/><lit-tag v="ill-på"/></let>
        </when>
        <when>
          <test><or>
            <in caseless="yes"><clip pos="1" side="sl" part="lemh"/><list n="ill-av-verbs"/></in>
            <ends-with><clip pos="1" side="sl" part="a_der"/><lit-tag v="Der_halla"/></ends-with>
          </or></test>
          <let><var n="caseprep"/><lit-tag v="ill-av"/></let>
        </when>
        <when>
          <test><in caseless="yes"><clip pos="1" side="sl" part="lemh"/><list n="loc-for-verbs"/></in></test>
          <let><var n="caseprep"/><lit-tag v="loc-for"/></let>
        </when>
        <when>
          <test><in caseless="yes"><clip pos="1" side="sl" part="lemh"/><list n="loc-om-verbs"/></in></test>
          <let><var n="caseprep"/><lit-tag v="loc-om"/></let>
        </when>
        <when>
          <test><in caseless="yes"><clip pos="1" side="sl" part="lemh"/><list n="loc-fra-verbs"/></in></test>
          <let><var n="caseprep"/><lit-tag v="loc-fra"/></let>
        </when>
        <otherwise c="No Change">
          <let><var n="caseprep"/><lit-tag v="NC"/></let>
        </otherwise>
      </choose>
      
      <choose c="Prepend 'ikke' if VAbess (should it be 'uten'?) TODO"><when>
        <test><equal><clip pos="1" side="sl" part="a_abess"/><lit-tag v="VAbess"/></equal></test>
        <out>
          <chunk name="adv" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="@ADVL"/></tag>
            </tags>
            <lu>
              <lit v="ikke"/>
              <lit-tag v="adv"/>
            </lu>
          </chunk>
          <b/>
        </out>
      </when></choose>
      
      <choose c="Prepend cnjsub if present progressive:
TODO: better translation possible? ('drev og'? 'holdt på å'?)"><when>
        <test><and>
          <equal><clip pos="1" side="sl" part="case"/><lit-tag v="Ess"/></equal>
          <equal><clip pos="1" side="sl" part="actio"/><lit-tag v="Actio"/></equal>
          <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@-FMAINV"/></equal>
        </and></test>
        <out>
          <chunk name="conj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="@CVP.cnjsub"/></tag>
            </tags>
            <lu>
              <lit v="i gang med å"/>
              <lit-tag v="cnjsub"/>
            </lu>
          </chunk>
          <b/>
        </out>
        <let><clip pos="1" side="tl" part="temps"/><lit-tag v="inf"/></let>
      </when></choose>
      
      <choose c="Prepend 'kunne/skulle/skal' if conditional:"><when>
        <test><or>
          <equal><clip pos="1" side="sl" part="modality"/><lit-tag v="Cond"/></equal>
          <equal><clip pos="1" side="sl" part="modality"/><lit-tag v="Cond2"/></equal>
          <equal><clip pos="1" side="sl" part="modality"/><lit-tag v="Cond3"/></equal>
        </or></test>
        <let><var n="tmp"/><lit v="kunne"/></let>
        <choose><when>
          <test><equal><clip pos="1" side="sl" part="modality"/><lit-tag v="Cond2"/></equal></test>
          <let><var n="tmp"/><lit v="skulle"/></let>
          <let><clip pos="1" side="tl" part="temps"/><lit-tag v="inf"/></let>
        </when></choose>
        <choose><when>
          <test><equal><clip pos="1" side="sl" part="modality"/><lit-tag v="Cond3"/></equal></test>
          <let><var n="tmp"/><lit v="skulle"/></let>
          <let><clip pos="1" side="tl" part="temps"/><lit-tag v="pres"/></let>
        </when></choose>
        <out>
          <chunk name="verb" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
              <tag><clip pos="1" side="sl" part="modality"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="animacy"/></tag>
              <tag><var n="caseprep"/></tag>
            </tags>
            <lu>
              <var n="tmp"/>
              <lit-tag v="vblex"/>
              <clip pos="1" side="tl" part="temps"/>
            </lu>
          </chunk>
          <b/>
        </out>
        <let><clip pos="1" side="tl" part="temps"/><lit-tag v="inf"/></let>
        <let><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@-FMAINV"/></let>
      </when></choose>
      
      <choose c="Prepend 'la' if causative:
TODO: 'få OBJ til å' vs 'la', correct syn_label, interaction with others types..."><when>
        <test>
          <equal><clip pos="1" side="tl" part="a_caus"/><lit-tag v="caus"/></equal>
        </test>
        <out>
          <chunk name="verb" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
              <tag><clip pos="1" side="sl" part="modality"/></tag>
              <tag><clip pos="1" side="tl" part="temps"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="animacy"/></tag>
              <tag><var n="caseprep"/></tag>
            </tags>
            <lu>
              <lit v="la"/>
              <lit-tag v="vblex"/>
              <clip pos="1" side="tl" part="temps"/>
            </lu>
          </chunk>
          <b/>
        </out>
        <let><clip pos="1" side="tl" part="temps"/><lit-tag v="inf"/></let>
        <let><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@-FMAINV"/></let>
      </when></choose>

      <choose c="If pstv and not pret/pres/pp/inf, turn into inf
                 (these have very limited paradigms, and adding an aux just doesn't sound good...)">
        <when>
          <test><and>
            <not><equal><clip pos="1" side="tl" part="a_pstv"/><lit v=""/></equal></not>
            <not><or>
              <equal><clip pos="1" side="tl" part="temps"/><lit-tag v="pret"/></equal>
              <equal><clip pos="1" side="tl" part="temps"/><lit-tag v="pres"/></equal>
              <equal><clip pos="1" side="tl" part="temps"/><lit-tag v="pp"/></equal>
              <equal><clip pos="1" side="tl" part="temps"/><lit-tag v="inf"/></equal>
            </or></not>
          </and></test>
          <let><clip pos="1" side="tl" part="temps"/><lit-tag v="inf"/></let>
        </when>
      </choose>
      
      <choose c="Prepend 'bli' aux (moving over temps) if
                 passive and pret/pp/pstv/imp/adj (and not a nominal derivation)
                 
                 TODO: OK to just discard syn_label from pret.passives?">
        <when>
          <test><and>
            <equal><clip pos="1" side="tl" part="voice"/><lit-tag v="pass"/></equal>
            <equal><clip pos="1" side="sl" part="a_nom_all"/><lit v=""/></equal>
            <or>
              <not><equal><clip pos="1" side="tl" part="a_adj"/><lit v=""/></equal></not>
              <not><equal><clip pos="1" side="tl" part="a_adv"/><lit v=""/></equal></not>
              <not><equal><clip pos="1" side="tl" part="a_nom_all"/><lit v=""/></equal></not>
              <not><equal><clip pos="1" side="tl" part="a_pstv"/><lit v=""/></equal></not>
              <equal><clip pos="1" side="tl" part="temps"/><lit-tag v="pret"/></equal>
              <equal><clip pos="1" side="tl" part="temps"/><lit-tag v="pp"/></equal>
              <equal><clip pos="1" side="tl" part="temps"/><lit-tag v="imp"/></equal>
            </or>
          </and></test>
          <let><var n="c_syn"/><lit-tag v="@+FAUXV"/></let>
          <choose><when>
            <test><in><clip pos="1" side="tl" part="temps"/><list n="infinite_temps"/></in></test>
            <let><var n="c_syn"/><lit-tag v="@-FAUXV"/></let>
          </when></choose>
          <let><var n="c_animacy"/><lit-tag v="impers"/></let>
          <choose><when>
            <test><in><clip pos="1" side="tl" part="lem"/><list n="animate_nonagent-verbs"/></in></test>
            <let><var n="c_animacy"/><lit-tag v="pers"/></let>
          </when></choose>
          <out>
            <chunk name="verb" case="caseFirstWord">
              <tags>
                <tag><lit-tag v="SV"/></tag>
                <tag><var n="c_syn"/></tag>
                <tag><clip pos="1" side="sl" part="mode"/></tag>
                <tag><clip pos="1" side="sl" part="modality"/></tag>
                <tag><clip pos="1" side="tl" part="temps"/></tag>
                <tag><clip pos="1" side="tl" part="pers"/></tag>
                <tag><clip pos="1" side="tl" part="nbr"/></tag>
                <tag><var n="c_animacy"/></tag>
                <tag><var n="caseprep"/></tag>
              </tags>
              <lu>
                <lit v="bli"/>
                <lit-tag v="vblex"/>
                <clip pos="1" side="tl" part="temps"/>
              </lu>
            </chunk>
            <b/>
          </out>
          <let><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@-FMAINV"/></let>
          <let><clip pos="1" side="tl" part="temps"/><lit-tag v="pp"/></let>
          <let><clip pos="1" side="tl" part="voice"/><lit v=""/></let>
          <let><clip pos="1" side="tl" part="voice"/><lit v=""/></let> <!-- yes twice, bidix can add two tags :/ -->
        </when>
      </choose>
      
      <choose c="Output the main predicate, verb/adj/noun/adv/etc.">
        <when c="adv (eg. negative)">
          <test><not><equal><clip pos="1" side="tl" part="a_adv"/><lit v=""/></equal></not></test>
          <append n="c_name"><lit v="adv"/></append>
          <out>
            <chunk namefrom="c_name" case="caseFirstWord">
              <tags>
                <tag><lit-tag v="SV"/></tag>
                <tag><clip pos="1" side="sl" part="syn_label"/></tag>
                <tag><clip pos="1" side="sl" part="neg"/></tag>
                <tag><clip pos="1" side="sl" part="mode"/></tag>
                <tag><clip pos="1" side="sl" part="modality"/></tag>
                <tag><clip pos="1" side="tl" part="temps"/></tag>
                <tag><clip pos="1" side="tl" part="voice"/></tag>
                <tag><clip pos="1" side="tl" part="pers"/></tag>
                <tag><clip pos="1" side="tl" part="nbr"/></tag>
                <tag><clip pos="1" side="tl" part="animacy"/></tag>
                <tag><var n="caseprep"/></tag>
              </tags>
              <var n="pre-verb"/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_adv"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </chunk>
          </out>
        </when>
        <when c="Noun">
          <test><not><equal><clip pos="1" side="tl" part="a_nom_all"/><lit v=""/></equal></not></test>
          <let><var n="pre-nom"/><var n="pre-verb"/></let>
          <call-macro n="set_defnes"><with-param pos="1"/></call-macro>
          <call-macro n="out_nom"><with-param pos="1"/></call-macro>
        </when>
        <when c="Adj">
          <test><not><equal><clip pos="1" side="tl" part="a_adj"/><lit v=""/></equal></not></test>
          <call-macro n="set_c_gen_nbr"><with-param pos="1"/></call-macro>
          <append n="c_name"><lit v="adj"/></append>
          <out>
            <chunk namefrom="c_name" case="caseFirstWord">
              <tags>
                <tag><lit-tag v="SA"/></tag>
                <tag><clip pos="1" side="sl" part="syn_label"/></tag>
                <tag><clip pos="1" side="sl" part="mode"/></tag>
                <tag><clip pos="1" side="sl" part="modality"/></tag>
                <tag><clip pos="1" side="tl" part="temps"/></tag>
                <tag><clip pos="1" side="tl" part="voice"/></tag>
                <tag><clip pos="1" side="tl" part="pers"/></tag>
                <tag><var n="c_gen"/></tag>
                <tag><var n="c_nbr"/></tag>
                <tag><clip pos="1" side="tl" part="animacy"/></tag>
                <tag><var n="caseprep"/></tag>
              </tags>
              <var n="pre-verb"/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_adj"/>
                <clip pos="1" side="tl" part="grau"/>
                <lit-tag v="GD.ND.ind"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </chunk>
          </out>
        </when>
        <otherwise c="Verb">
          <choose>
            <when>
              <test><equal caseless="yes"><clip pos="1" side="tl" part="lemh"/><lit v="være"/></equal></test>
              <append n="c_name"><lit v="vcop"/></append>
            </when>
            <otherwise>
              <append n="c_name"><lit v="verb"/></append>
            </otherwise>
          </choose>
          <out>
            <chunk namefrom="c_name" case="caseFirstWord">
              <tags>
                <tag><lit-tag v="SV"/></tag>
                <tag><clip pos="1" side="sl" part="syn_label"/></tag>
                <tag><clip pos="1" side="sl" part="mode"/></tag>
                <tag><clip pos="1" side="sl" part="modality"/></tag>
                <tag><clip pos="1" side="tl" part="temps"/></tag>
                <tag><clip pos="1" side="tl" part="voice"/></tag>
                <tag><clip pos="1" side="tl" part="pers"/></tag>
                <tag><clip pos="1" side="tl" part="nbr"/></tag>
                <tag><clip pos="1" side="tl" part="animacy"/></tag>
                <tag><var n="caseprep"/></tag>
              </tags>
              <var n="pre-verb"/>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_verb"/>
                <clip pos="1" side="tl" part="a_pstv"/>
                <clip pos="1" side="tl" part="temps"/>
                <clip pos="1" side="tl" part="voice"/>
                <!-- lemq is given its own chunk below -->
              </lu>
            </chunk>
          </out>
        </otherwise>
      </choose>

      <choose><when c="Append 'seg' if reflexive:">
        <test><equal><clip pos="1" side="tl" part="a_rel"/><lit-tag v="ref"/></equal></test>
        <let><var n="pron_nbr"/><clip pos="1" side="tl" part="nbr"/></let>
        <let><var n="pron_pers"/><clip pos="1" side="tl" part="pers"/></let>
        <choose><when>
          <test><equal><clip pos="1" side="tl" part="nbr"/><lit v=""/></equal></test>
          <let><var n="pron_nbr"/><lit-tag v="sg"/></let>
        </when></choose>
        <choose><when>
          <test><equal><clip pos="1" side="tl" part="pers"/><lit v=""/></equal></test>
          <let><var n="pron_pers"/><lit-tag v="p3"/></let>
        </when></choose>
        <out>
          <b/>
          <chunk name="pron">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><lit-tag v="@←OBJ"/></tag>
              <tag><var n="pron_pers"/></tag>
              <tag><var n="pron_nbr"/></tag>
              <tag><lit-tag v="acc"/></tag>
            </tags>
            <lu>
              <lit v="seg"/>
              <lit-tag v="prn.ref"/>
              <var n="pron_pers"/>
              <var n="pron_nbr"/>
            </lu>
          </chunk>
        </out>
      </when></choose>

      <choose><when c="the lemq was not output in the above 'otherwise'; output as a chunk here">
        <test><and>
          <equal><clip pos="1" side="tl" part="a_adj"/><lit v=""/></equal>
          <equal><clip pos="1" side="tl" part="a_nom_all"/><lit v=""/></equal>
          <equal><clip pos="1" side="tl" part="a_adv"/><lit v=""/></equal>
          <not><equal><clip pos="1" side="tl" part="lemq"/><lit v=""/></equal></not>
        </and></test>
        <out>
          <chunk name="lemq">
            <tags>
              <tag><lit-tag v="lemq"/></tag>
              <tag><clip pos="1" side="tl" part="a_lemq"/></tag>
            </tags>
            <lu><clip pos="1" side="tl" part="lemq"/></lu>
          </chunk>
        </out>
      </when></choose>
    </def-macro>
  </section-def-macros>
  
  <section-rules>
    <!-- <rules: MWE interjections (which can't be in analyser as multiwords) -->
    <rule comment="REGLA: IJ-ADJ IJ-NOM">
      <pattern>
        <pattern-item n="ij-adj"/>
        <pattern-item n="ij-nom"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <call-macro n="set_c_syn"><with-param pos="2"/></call-macro>
        <call-macro n="modify_adj_gen_nbr"><with-param pos="2"/><with-param pos="1"/></call-macro>

        <out>
          <chunk name="pre_nom" case="caseFirstWord">
            <tags>
              <tag><var n="c_syn"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="grau"/>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="sg"/>
              <lit-tag v="ind"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="sg"/>
              <lit-tag v="ind"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: IJ-ADJ IJ-ADJ2 IJ-NOM">
      <pattern>
        <pattern-item n="ij-adj"/>
        <pattern-item n="ij-adj2"/>
        <pattern-item n="ij-nom"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <call-macro n="set_c_syn"><with-param pos="3"/></call-macro>
        <call-macro n="modify_adj_gen_nbr"><with-param pos="3"/><with-param pos="1"/></call-macro>
        <call-macro n="modify_adj_gen_nbr"><with-param pos="3"/><with-param pos="2"/></call-macro>

        <out>
          <chunk name="pre_pre_nom" case="caseFirstWord">
            <tags>
              <tag><var n="c_syn"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="grau"/>
              <clip pos="1" side="tl" part="gen"/>
              <lit-tag v="sg"/>
              <lit-tag v="ind"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="grau"/>
              <clip pos="2" side="tl" part="gen"/>
              <lit-tag v="sg"/>
              <lit-tag v="ind"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <lit-tag v="sg"/>
              <lit-tag v="ind"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- <rules: Dates (need to be before num_nom rules) -->
    <rule comment="REGLA: MONTH ORD BEAIVI
                   guovvamánu 17. beaivvi => 17. februar
                   TODO: should we also chunk MONTH NUM DOT BEAIVI YEAR ?
                   TODO: should we always delete the genitive here?
                   TODO: do we ever want definite? ('den 17.februar')?">
      <pattern>
        <pattern-item n="month"/>
        <pattern-item n="ord"/>
        <pattern-item n="beaivi"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="pre_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="3" side="sl" part="syn_label"/></tag>
              <tag><clip pos="3" side="sl" part="mode"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <!-- <tag><lit-tag v="def"/></tag> -->
              <tag><clip pos="3" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <lit-tag v="adj.ord.posi.sg.def"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ind"/>
              <!-- <clip pos="1" side="tl" part="gen-case"/> -->
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <choose><when>
          <test><not><equal><b pos="2"/><b/></equal></not></test>
          <out><b pos="2"/></out>
        </when></choose>
      </action>
    </rule>
    <rule comment="REGLA: DIIBMU NUM
                   diibmu 11.00 => klokken 11.00">
      <pattern>
        <pattern-item n="diibmu"/>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <choose><when>
          <test><equal><clip pos="2" side="tl" part="gen"/><lit-tag v="GD"/></equal></test>
          <let><clip pos="2" side="tl" part="gen"/><lit-tag v="nt"/></let>
          <let><clip pos="2" side="tl" part="lemh"/><lit v="én"/></let> <!-- ett -->
        </when></choose>
        <out>
          <chunk name="nom_det" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
              <tag><lit-tag v="def"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="def"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_num"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: SEASON NUM
                   1990 giđa => våren 1990
                   Always definite (should not add a determiner in t4x)
                   Removes genitive from season (selected by numeral)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="season"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <choose><when c="shouldn't happen, but might get a mistagging">
          <test><equal><clip pos="1" side="tl" part="gen"/><lit-tag v="GD"/></equal></test>
          <let><clip pos="1" side="tl" part="gen"/><clip pos="2" side="tl" part="gen"/></let>
        </when></choose>
        <out>
          <chunk name="nom_det" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="2" side="sl" part="syn_label"/></tag>
              <tag><clip pos="2" side="sl" part="mode"/></tag>
              <tag><clip pos="2" side="tl" part="gen"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
              <tag><lit-tag v="def"/></tag>
              <tag><clip pos="2" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="def"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: NUM.CMP NOM
                   1990-logu => 1990-tallet
                   Always definite (should not add a determiner in t4x)
                   if a_cmp is 'dash', nob.dix adds a dash">
      <pattern>
        <pattern-item n="num.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <let><var n="c_name"/><lit v="pre_"/></let>
        <!-- no modify_nomcmp_nbr_art for numcmp -->

        <choose><when>
          <test><equal><clip pos="2" side="tl" part="lemh"/><lit v="lohku"/></equal></test>
          <let><clip pos="2" side="tl" part="nbr"/><lit-tag v="sg"/></let>
        </when></choose>

        <choose><when c="Remove dash from spelled out numbers preceding non-numbers (logi-jagáš → tiåret)">
          <test><not><equal><clip pos="1" side="sl" part="nbr"/><lit v=""/></equal></not></test>
          <let><clip pos="1" side="tl" part="a_cmp"/><lit v=""/></let>
        </when></choose>

        <call-macro n="copy_syn_label"><with-param pos="2"/><with-param pos="1"/></call-macro>
        <let><var n="defnes"/><lit-tag v="def"/></let>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="a_cmp"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="2"/></call-macro>
      </action>
    </rule>
    <rule comment="REGLA: NUM.CMP NOM.CMP NOM
                   1990-logu => 1990-tallet
                   Always definite (should not add a determiner in t4x)
                   if a_cmp is 'dash', nob.dix adds a dash">
      <pattern>
        <pattern-item n="num.cmp"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <let><var n="c_name"/><lit v="pre_pre_"/></let>
        <!-- no modify_nomcmp_nbr_art for numcmp -->
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="2"/></call-macro>

        <choose><when>
          <test><equal><clip pos="3" side="tl" part="lemh"/><lit v="lohku"/></equal></test>
          <let><clip pos="3" side="tl" part="nbr"/><lit-tag v="sg"/></let>
        </when></choose>

        <choose><when c="Remove dash from spelled out numbers preceding non-numbers (logi-jagáš → tiåret)">
          <test><not><equal><clip pos="1" side="sl" part="nbr"/><lit v=""/></equal></not></test>
          <let><clip pos="1" side="tl" part="a_cmp"/><lit v=""/></let>
        </when></choose>
        
        <call-macro n="copy_syn_label"><with-param pos="3"/><with-param pos="1"/></call-macro>
        <let><var n="defnes"/><lit-tag v="def"/></let>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="a_cmp"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>
    
    <!-- <rules: Proper nouns -->
    <rule comment="REGLA: NOM.PROP
                   Needs to be before the NOM rule.">
      <pattern>
        <pattern-item n="nom.prop"/>
      </pattern>
      <action>
        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <var n="caseprep"/>
          <chunk name="nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><lit-tag v="ind"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="gen-case"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: NOM.PROP NOM.PROP
                   Gender from the first np, syntax from the last one">
      <pattern>
        <pattern-item n="nom.prop_mod"/>
        <pattern-item n="nom.prop"/>
      </pattern>
      <action>
        <call-macro n="set_caseprep"><with-param pos="2"/></call-macro>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <var n="caseprep"/>
          <chunk name="pre_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="2" side="sl" part="syn_label"/></tag>
              <tag><lit-tag v="ind"/></tag>
              <tag><clip pos="2" side="sl" part="mode"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="2" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="gen-case"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <rule comment="REGLA: NOM.PROP_MOD NOM.PROP_MOD NOM.PROP
                   Gender from the first np, syntax from the last one">
      <pattern>
        <pattern-item n="nom.prop_mod"/>
        <pattern-item n="nom.prop_mod"/>
        <pattern-item n="nom.prop"/>
      </pattern>
      <action>
        <call-macro n="set_caseprep"><with-param pos="3"/></call-macro>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <var n="caseprep"/>
          <chunk name="pre_pre_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="3" side="sl" part="syn_label"/></tag>
              <tag><lit-tag v="ind"/></tag>
              <tag><clip pos="3" side="sl" part="mode"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="3" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="gen-case"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: NOM.PROP_ATTR NOM.PROP.ANTCOG
                   (šattai) Prinsa Harald (Ruvdnaprinsan) => (ble) Prins Harald (kronprins)
                   Uses NOM.PROP gender if possible as chunk gender.">
      <pattern>
        <pattern-item n="nom.prop_attr"/>
        <pattern-item n="nom.prop.antcog"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        <call-macro n="set_c_gen_nbr"><with-param pos="1"/></call-macro>
        <choose><when>
          <test><not><equal><clip pos="2" side="tl" part="gen"/><lit v=""/></equal></not></test>
          <let><var n="c_gen"/><clip pos="2" side="tl" part="gen"/></let>
        </when></choose>
        
        <choose>
          <when>
            <test><begins-with><clip pos="1" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with></test>
            <let><clip pos="1" side="tl" part="nbr"/><lit v=""/></let>
            <let><clip pos="1" side="tl" part="ind"/><lit v=""/></let>
          </when>
          <otherwise>
            <let><clip pos="1" side="tl" part="whole"/><concat><clip pos="1" side="tl" part="whole"/><lit-tag v="ind"/></concat></let>
          </otherwise>
        </choose>
        
        <out>
          <var n="caseprep"/>
          <chunk name="pre_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="2" side="sl" part="syn_label"/></tag>
              <tag><lit-tag v="ind"/></tag>
              <tag><clip pos="2" side="sl" part="mode"/></tag>
              <tag><var n="c_gen"/></tag>
              <tag><var n="c_nbr"/></tag>
              <tag><clip pos="2" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: NOM.PROP_ATTR NOM.PROP.ANTCOG_MOD NOM.PROP.ANTCOG
                   « ..., muitala rektor Liisa Holmberg. »
                   Uses middle NOM.PROP gender if possible as chunk gender.">
      <pattern>
        <pattern-item n="nom.prop_attr"/>
        <pattern-item n="nom.prop.antcog_mod"/>
        <pattern-item n="nom.prop.antcog"/>
      </pattern>
      <action>
        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <call-macro n="set_c_gen_nbr"><with-param pos="1"/></call-macro>
        <choose><when>
          <test><not><equal><clip pos="2" side="tl" part="gen"/><lit v=""/></equal></not></test>
          <let><var n="c_gen"/><clip pos="2" side="tl" part="gen"/></let>
        </when></choose>
        
        <choose>
          <when>
            <test><begins-with><clip pos="1" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with></test>
            <let><clip pos="1" side="tl" part="nbr"/><lit v=""/></let>
            <let><clip pos="1" side="tl" part="ind"/><lit v=""/></let>
          </when>
          <otherwise>
            <let><clip pos="1" side="tl" part="whole"/><concat><clip pos="1" side="tl" part="whole"/><lit-tag v="ind"/></concat></let>
          </otherwise>
        </choose>

        <out>
          <var n="caseprep"/>
          <chunk name="pre_pre_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="3" side="sl" part="syn_label"/></tag>
              <tag><lit-tag v="ind"/></tag>
              <tag><clip pos="3" side="sl" part="mode"/></tag>
              <tag><var n="c_gen"/></tag>
              <tag><var n="c_nbr"/></tag>
              <tag><clip pos="3" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="gen-case"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: NOM.CMP NOM.PROP_ATTR NOM.PROP.ANTCOG
                   Ruvdnaprinsa Harald => Kronprins Harald
                   Uses NOM.PROP gender if possible as chunk gender.">
      <pattern>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom.prop_attr"/>
        <pattern-item n="nom.prop.antcog"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="2"/></call-macro>
        <call-macro n="set_caseprep"><with-param pos="2"/></call-macro>
        <call-macro n="set_c_gen_nbr"><with-param pos="2"/></call-macro>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="1"/></call-macro>
        <choose><when>
          <test><not><equal><clip pos="3" side="tl" part="gen"/><lit v=""/></equal></not></test>
          <let><var n="c_gen"/><clip pos="3" side="tl" part="gen"/></let>
        </when></choose>
        
        <choose>
          <when>
            <test><begins-with><clip pos="2" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with></test>
            <let><clip pos="2" side="tl" part="nbr"/><lit v=""/></let>
            <let><clip pos="2" side="tl" part="ind"/><lit v=""/></let>
          </when>
          <otherwise>
            <let><clip pos="2" side="tl" part="whole"/><concat><clip pos="2" side="tl" part="whole"/><lit-tag v="ind"/></concat></let>
          </otherwise>
        </choose>
        
        <out>
          <var n="caseprep"/>
          <chunk name="pre_pre_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="3" side="sl" part="syn_label"/></tag>
              <tag><lit-tag v="ind"/></tag>
              <tag><clip pos="3" side="sl" part="mode"/></tag>
              <tag><var n="c_gen"/></tag>
              <tag><var n="c_nbr"/></tag>
              <tag><clip pos="3" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
            <b pos="2"/>
            <lu>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    <!-- <rules: Noun, numeral+noun and compounds -->
    <rule comment="REGLA: NOM (tl: NOM, VERB)">
      <pattern>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <let><var n="c_name"/><lit v=""/></let>
        <let><var n="pre-nom"/><lit v=""/></let>
        <call-macro n="set_defnes"><with-param pos="1"/></call-macro>
        <call-macro n="out_nom"><with-param pos="1"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: NUM NOM.GEN_NUMl
                   -----
                   Here the head (caseprep, syn_label) is the numeral!
                   Numerals take genitive case, chunk case is numeral case,
                   so we don't use out_nom
                   TODO: enforce double defnes? (de tre bilene)">
      <pattern>
        <pattern-item n="num"/>
        <pattern-item n="nom.gen_NUMl"/>
      </pattern>
      <action>
        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        <call-macro n="set_defnes2"><with-param pos="2"/><with-param pos="1"/></call-macro> 
        
        <call-macro n="set_c_gen_nbr"><with-param pos="2"/></call-macro>
        <call-macro n="set_c_syn"><with-param pos="1"/></call-macro>

        <let><var n="tmp"/><b pos="1"/></let>
        <choose>
          <when>
            <test><or>
              <begins-with><clip pos="2" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with>
              <equal><clip pos="2" side="tl" part="a_nom"/><lit-tag v="n.acr"/></equal>
            </or></test>
            <let><var n="n_nbr"/><lit v=""/></let>
            <let><var n="c_def_pos"/><lit v=""/></let>
          </when>
          <when c="logi-jagáš → tiåret">
            <test><and>
              <equal><clip pos="2" side="tl" part="lemh"/><lit v="år"/></equal>
              <equal><b pos="1"/><lit v="-"/></equal>
            </and></test>
            <let><var n="n_nbr"/><lit-tag v="sg"/></let>
            <let><var n="c_def_pos"/><lit-tag v="def"/></let>
            <let><var n="tmp"/><lit v=""/></let>
          </when>
          <otherwise>
            <let><var n="n_nbr"/><clip pos="1" side="tl" part="nbr"/></let>
            <let><var n="c_def_pos"/><lit-tag v="3"/></let>
          </otherwise>
        </choose>

        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <var n="caseprep"/>
          <chunk name="pre_nom" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><var n="c_syn"/></tag>
              <tag><var n="defnes"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
              <tag><var n="c_gen"/></tag>
              <tag><var n="c_nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
              <tag><clip pos="1" side="tl" part="a_count"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <var n="tmp"/>      <!-- b pos=1 by default -->
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <var n="n_nbr"/>
              <var n="c_def_pos"/>
              <clip pos="1" side="tl" part="gen-case"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NUM_MOD NOM
                   -----
                   Oblique use of num nom, here the nominal is the head (caseprep, syn_label)
                   so we use out_nom
                   (but we copy genitive-case and number from the numeral onto the nom).
                   TODO: should we really copy genitive-case over? ('lea vuosttaš prinsa 567 jahkái')">
      <pattern>
        <pattern-item n="num_mod"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="set_defnes2"><with-param pos="2"/><with-param pos="1"/></call-macro>
        
        
        <let><var n="c_name"/><lit v="pre_"/></let>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
          </concat>
        </let>
        <let><clip pos="2" side="tl" part="case"/><clip pos="1" side="tl" part="gen-case"/></let>
        <choose><when>
          <test><not><equal><clip pos="2" side="sl" part="a_count"/><lit-tag v="Coll"/></equal></not></test>
          <let><clip pos="2" side="tl" part="nbr"/><clip pos="1" side="tl" part="nbr"/></let>
        </when></choose>
        <call-macro n="out_nom"><with-param pos="2"/></call-macro>
      </action>
    </rule>
    <rule comment="REGLA: NUM_MOD NOM.CMP NOM
                   -----
                   See NUM_MOD NOM">
      <pattern>
        <pattern-item n="num_mod"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="set_defnes2"><with-param pos="3"/><with-param pos="1"/></call-macro>
        
        <let><var n="c_name"/><lit v="pre_pre_"/></let>
        <!-- no modify_nomcmp_nbr_art for numcmp -->
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="2"/></call-macro>

        <call-macro n="copy_syn_label"><with-param pos="3"/><with-param pos="1"/></call-macro>

        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        <let><clip pos="3" side="tl" part="case"/><clip pos="1" side="tl" part="gen-case"/></let>
        <choose><when>
          <test><not><equal><clip pos="3" side="sl" part="a_count"/><lit-tag v="Coll"/></equal></not></test>
          <let><clip pos="3" side="tl" part="nbr"/><clip pos="1" side="tl" part="nbr"/></let>
        </when></choose>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>
    
    <rule comment="REGLA: NUM_MOD ADJ_ATTR NOM
                   -----
                   22 jahkásaš Tine
                   See NUM_MOD NOM">
      <pattern>
        <pattern-item n="num_mod"/>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="modify_adj_gen_nbr"><with-param pos="3"/><with-param pos="2"/></call-macro>

        <!-- not set_defnes2 here, seems to work better just looking at head syntax tag: -->
        <call-macro n="set_defnes"><with-param pos="3"/></call-macro>
        
        <let><var n="c_name"/><lit v="pre_pre_"/></let>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="grau"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <!-- We set use chunk defnes here for both adj and nom,
                   so that if defnes changes in t2x/t3x, both adj and nom
                   get the change in t4x -->
              <lit-tag v="3"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="2"/>
          </concat>
        </let>
        <let><clip pos="3" side="tl" part="case"/><clip pos="1" side="tl" part="gen-case"/></let>
        <choose><when>
          <test><not><equal><clip pos="3" side="sl" part="a_count"/><lit-tag v="Coll"/></equal></not></test>
          <let><clip pos="3" side="tl" part="nbr"/><clip pos="1" side="tl" part="nbr"/></let>
        </when></choose>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>
    <rule comment="REGLA: NUM_MOD DET_MOD ADJ_ATTR NOM
                   -----
                   máŋggain eará smávit fatnasiiguin => med de mange andre mindre båtene">
      <pattern>
        <pattern-item n="num_mod"/>
        <pattern-item n="det_mod"/>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="clean_a_det"><with-param pos="2"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="2"/></call-macro>
        <call-macro n="set_pron_gen_nbr_art"><with-param pos="4"/></call-macro>
        <call-macro n="set_c_syn"><with-param pos="1"/></call-macro>

        <call-macro n="modify_adj_gen_nbr"><with-param pos="4"/><with-param pos="3"/></call-macro>

        <call-macro n="set_defnes2"><with-param pos="4"/><with-param pos="1"/></call-macro>
        
        <let><var n="c_name"/><lit v="pre_pre_pre_"/></let>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_det"/>
              <var n="pron_gen"/>
              <var n="pron_nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="2"/>
            <lit v="^"/>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="grau"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <!-- We set use chunk defnes here for both adj and nom,
                   so that if defnes changes in t2x/t3x, both adj and nom
                   get the change in t4x -->
              <lit-tag v="3"/>
              <clip pos="3" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="3"/>
          </concat>
        </let>
        <let><clip pos="4" side="tl" part="case"/><clip pos="1" side="tl" part="gen-case"/></let>
        <choose><when>
          <test><not><equal><clip pos="4" side="sl" part="a_count"/><lit-tag v="Coll"/></equal></not></test>
          <let><clip pos="4" side="tl" part="nbr"/><clip pos="1" side="tl" part="nbr"/></let>
        </when></choose>
        <call-macro n="out_nom"><with-param pos="4"/></call-macro>
      </action>
    </rule>
    <rule comment="REGLA: NUM_MOD NOM.GEN NOM
                   -----
                   Oblique use of num nom, here the final nominal is the head
                   See NUM_MOD NOM rule.">
      <pattern>
        <pattern-item n="num_mod"/>
        <pattern-item n="nom.gen"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <let><var n="c_name"/><lit v="pre_pre_"/></let>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
          </concat>
        </let>
        
        <!-- for NOM.GEN -->
        <call-macro n="set_defnes2"><with-param pos="2"/><with-param pos="1"/></call-macro>
        <choose><when>
          <test><begins-with><clip pos="2" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with></test>
          <let><var n="defnes"/><lit v=""/></let>
          <let><clip pos="2" side="tl" part="nbr"/><lit v=""/></let>
        </when></choose>
        <append n="pre-nom">
          <concat>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <var n="defnes"/>
              <clip pos="2" side="tl" part="gen-case"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="2"/>
          </concat>
        </append>
        
        <!-- for possessed NOM -->        
        <let><var n="defnes"/><lit-tag v="ind"/></let>

        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>


    <rule comment="REGLA: ADJ.CMP NOM
                   -----
                   allaskuvla => høyskole
                   Moves syn_label from CMP to NOM">
      <pattern>
        <pattern-item n="adj.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="modify_adj_gen_nbr"><with-param pos="2"/><with-param pos="1"/></call-macro>

        <let><var n="c_name"/><lit v="pre_"/></let>

        <call-macro n="copy_syn_label"><with-param pos="2"/><with-param pos="1"/></call-macro>
        <call-macro n="set_defnes"><with-param pos="2"/></call-macro>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="grau"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="ind"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="2"/></call-macro>
      </action>
    </rule>
    
    <rule comment="REGLA: NOM.CMP NOM
                   -----
                   politiijastašuvnna => politistasjon(s)
                   Moves syn_label from CMP to NOM">
      <pattern>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        
        <let><var n="c_name"/><lit v="pre_"/></let>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="1"/></call-macro>
        
        <call-macro n="copy_syn_label"><with-param pos="2"/><with-param pos="1"/></call-macro>
        <call-macro n="set_defnes"><with-param pos="2"/></call-macro>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="2"/></call-macro>
      </action>
    </rule>
    
    <rule comment="REGLA: NOM.CMP NOM.CMP NOM
                   -----
                   Ruvdnaprinsabáras => Kronprinsparet
                   Moves syn_label from first CMP to NOM">
      <pattern>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        
        <let><var n="c_name"/><lit v="pre_pre_"/></let>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="1"/></call-macro>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="2"/></call-macro>
        
        <call-macro n="copy_syn_label"><with-param pos="3"/><with-param pos="1"/></call-macro>
        <call-macro n="set_defnes"><with-param pos="3"/></call-macro>
        
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: CMP NOM
                   -----
                   vuođđofága => grunnfag
                   mielbargin => som medarbeider
                   Words which only appear as compound parts should be fully specified in bidix.
                   Moves syn_label from CMP to NOM">
      <pattern>
        <pattern-item n="cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        
        <call-macro n="copy_syn_label"><with-param pos="2"/><with-param pos="1"/></call-macro>
        <call-macro n="set_defnes"><with-param pos="2"/></call-macro>

        <let><var n="c_name"/><lit v="pre_"/></let>
        <let><clip pos="1" side="tl" part="syn_label"/><lit v=""/></let>
        <let><clip pos="1" side="tl" part="a_cmp"/><lit v=""/></let>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="whole"/>
            <lit v="$"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="2"/></call-macro>
      </action>
    </rule>
    
    <rule comment="REGLA: NOM.CMP ADJ
                   -----
                   sámegiel => samespråklig
                   Moves syn_label from CMP to NOM">
      <pattern>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        
        <call-macro n="set_c_gen_nbr"><with-param pos="2"/></call-macro>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="1"/></call-macro>
        <call-macro n="set_caseprep"><with-param pos="2"/></call-macro>
        <call-macro n="set_defnes"><with-param pos="2"/></call-macro>
        <out>
          <var n="caseprep"/>
          <chunk name="pre_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><var n="defnes"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
              <tag><var n="c_gen"/></tag>
              <tag><var n="c_nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="grau"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <var n="defnes"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- <rules: Lone determiners, pronouns, adverbs -->
    <rule comment="REGLA: PRON-NONREFERENTIAL maidege => noe
                   Like DET rule, but force nt sg">
      <pattern>
        <pattern-item n="pron-nonreferential"/>
      </pattern>
      <action>
        <call-macro n="clean_a_det"><with-param pos="1"/></call-macro>

        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="1"/></call-macro>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <let><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></let>
        <let><clip pos="1" side="tl" part="gen"/><lit-tag v="nt"/></let>

        <out>
          <var n="caseprep"/>
          <chunk name="det" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <clip pos="1" side="tl" part="case"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: DET dán => dette
                              munno [geažil] => [på grunn av] oss to">
      <pattern>
        <pattern-item n="det"/>
      </pattern>
      <action>
        <call-macro n="clean_a_det"><with-param pos="1"/></call-macro>

        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="1"/></call-macro>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <out>
          <var n="caseprep"/>
          <chunk name="det" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <clip pos="1" side="tl" part="case"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>    
    
    <rule comment="REGLA: RELATIVE_PRONOUN gii => som
                   Just removes everything.
                   (Should we call the chunk something else maybe?)">
      <pattern>
        <pattern-item n="pron.rel"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="rel" case="caseFirstWord">
            <tags>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_conj"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: REFLEXIVE_PRONOUN ieš => seg / h*n
                   Just removes everything from normal reflexives,
                   changes @-FOBJ→ reflexives into personal pronouns with GD + nom
                   Does not match genitive reflexives (treated as det.pos)
                   TODO: Son osku iežas(@-FSUBJ→) bestojuvvon(@X)">
      <pattern>
        <pattern-item n="pron.ref"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        
        <choose>
          <when>
            <test><equal><clip pos="1" side="tl" part="lemh"/><lit v="prpers"/></equal></test>
            <out>
              <var n="caseprep"/>
              <chunk name="pron" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><clip pos="1" side="sl" part="syn_label"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><lit-tag v="GD"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                  <tag><lit-tag v="nom"/></tag>
                </tags>
                <lu>
                  <lit v="prpers"/>
                  <lit-tag v="prn"/>
                  <clip pos="1" side="tl" part="pers"/>
                  <lit-tag v="GD"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="nom"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <when c="Adverb (eg. 'på egen hånd'): no caseprep">
            <test><not><equal><clip pos="1" side="tl" part="a_adv"/><lit v=""/></equal></not></test>
            <out>
              <chunk name="adv" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="@ADVL"/></tag>
                  <tag><clip pos="1" side="tl" part="mode"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adv"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <when c="selv.det.emph">
            <test><not><equal><clip pos="1" side="tl" part="a_det"/><lit v=""/></equal></not></test>
            <out>
              <var n="caseprep"/>
              <chunk name="det" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SN"/></tag>
                  <tag><clip pos="1" side="sl" part="syn_label"/></tag>
                  <tag><clip pos="1" side="tl" part="pers"/></tag>
                  <tag><clip pos="1" side="tl" part="gen"/></tag>
                  <tag><clip pos="1" side="tl" part="nbr"/></tag>
                  <tag><clip pos="1" side="tl" part="case"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_det"/>
                  <clip pos="1" side="tl" part="pers"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <clip pos="1" side="tl" part="case"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
        <otherwise>
          <out>
            <var n="caseprep"/>
            <chunk name="pron" case="caseFirstWord">
              <tags>
                <tag><lit-tag v="SN"/></tag>
                <tag><clip pos="1" side="sl" part="syn_label"/></tag>
                <tag><clip pos="1" side="tl" part="pers"/></tag>
                <tag><clip pos="1" side="tl" part="gen"/></tag>
                <tag><clip pos="1" side="tl" part="nbr"/></tag>
                <tag><clip pos="1" side="tl" part="case"/></tag>
              </tags>
              <lu>
                <clip pos="1" side="tl" part="lemh"/>
                <clip pos="1" side="tl" part="a_pron"/>
                <clip pos="1" side="tl" part="pers"/>
                <clip pos="1" side="tl" part="nbr"/>
                <clip pos="1" side="tl" part="lemq"/>
              </lu>
            </chunk>
          </out>
        </otherwise>
        </choose>
      </action>
    </rule>
    
    <rule comment="REGLA: PERSONAL_PRONOUN REFLEXIVE_PRONOUN
                   (Jus in livčče) mun ieš => (Hvis jeg ikke kan være) meg.acc selv
                   moai ieža vel válljejetne => vi_to.nom selv (vi_to velger)
                   Changes prpers case to accusative unless subject.
                   TODO: this really ought to be an mwe specified in the sme dictionary. Will this rule catch too much?">
      <pattern>
        <pattern-item n="pron.pers"/>
        <pattern-item n="pron.ref_PRONl"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        
        <choose><when>
          <test><not><or>
            <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@SUBJ→"/></equal>
            <equal><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@←SUBJ"/></equal>
          </or></not></test>
          <let><clip pos="1" side="tl" part="case"/><lit-tag v="acc"/></let>
        </when></choose>
        
        <out>
          <var n="caseprep"/>
          <chunk name="pron" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_pron"/>
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="case"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk name="det">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="2" side="sl" part="syn_label"/></tag>
              <tag><clip pos="2" side="tl" part="pers"/></tag>
              <tag><clip pos="2" side="tl" part="gen"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
              <tag><clip pos="2" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_det"/>
              <clip pos="2" side="tl" part="pers"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="case"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: INTERROGATIVE_PRONOUN mii => hva">
      <pattern>
        <pattern-item n="pronitg"/>
      </pattern>
      <action>
        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <var n="caseprep"/>
          <chunk name="pron" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_pron"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: PERSONAL_PRONOUN
                   This will catch genitive pronouns too (we're outputting both a_pron and a_det).
                   Not all genitive pronouns turn into determiners.">
      <pattern>
        <pattern-item n="pron.pers"/>
      </pattern>
      <action>
        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="1"/></call-macro>

        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <var n="caseprep"/>
          <chunk name="pron" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_pron"/>
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="case"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <!-- <rules: DET* ADJ* NOM* -->

    <rule comment="REGLA: ADJ
                   -----
                   dehálaš => viktig, deháleamos => viktigst
                   bassivuođa => det hellige">
      <pattern>
        <pattern-item n="adj"/>
      </pattern>
      <action>        
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        
        <call-macro n="set_c_gen_nbr"><with-param pos="1"/></call-macro>
        <call-macro n="set_defnes"><with-param pos="1"/></call-macro>
        <call-macro n="set_c_syn"><with-param pos="1"/></call-macro>

        <choose>
          <when>
            <test><not><equal><clip pos="1" side="sl" part="a_nom_all"/><lit v=""/></equal></not></test>
            <let><var n="defnes"/><lit-tag v="def"/></let>
            <out>
              <chunk name="pre_adj" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SA"/></tag>
                  <tag><var n="c_syn"/></tag>
                  <tag><var n="defnes"/></tag>
                  <tag><clip pos="1" side="sl" part="mode"/></tag>
                  <tag><lit-tag v="nt"/></tag>
                  <tag><lit-tag v="sg"/></tag>
                </tags>
                <lu>
                  <lit v="den"/><lit-tag v="det.dem.nt.sg"/>
                </lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="grau"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="3"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>
            <out>
              <chunk name="adj" case="caseFirstWord">
                <tags>
                  <tag><lit-tag v="SA"/></tag>
                  <tag><var n="c_syn"/></tag>
                  <tag><var n="defnes"/></tag>
                  <tag><clip pos="1" side="sl" part="mode"/></tag>
                  <tag><var n="c_gen"/></tag>
                  <tag><var n="c_nbr"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adj"/>
                  <clip pos="1" side="tl" part="grau"/>
                  <clip pos="1" side="tl" part="gen"/>
                  <clip pos="1" side="tl" part="nbr"/>
                  <lit-tag v="3"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>

    <rule comment="REGLA: ADJ_ATTR NOM
                   -----
                   almmolaš bálvalusaide => til offentlige tjenester
                   almmolaš bálvalus => (den) offentlige tjenesten">
      <pattern>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        
        <call-macro n="modify_adj_gen_nbr"><with-param pos="2"/><with-param pos="1"/></call-macro>

        <let><var n="c_name"/><lit v="pre_"/></let>

        <call-macro n="set_defnes"><with-param pos="2"/></call-macro>
        
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="grau"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <!-- We set use chunk defnes here for both adj and nom,
                   so that if defnes changes in t2x/t3x, both adj and nom
                   get the change in t4x -->
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="2"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: ADJ_ATTR ADJ_ATTR NOM
                   -----
                   ođđa almmolaš bálvalusaide => til nye offentlige tjenester
                   ođđa almmolaš bálvalus => (den) nye offentlige tjenesten">
      <pattern>
        <pattern-item n="adj_attr"/>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        
        <call-macro n="modify_adj_gen_nbr"><with-param pos="3"/><with-param pos="1"/></call-macro>
        <call-macro n="modify_adj_gen_nbr"><with-param pos="3"/><with-param pos="2"/></call-macro>

        <let><var n="c_name"/><lit v="pre_pre_"/></let>

        <call-macro n="set_defnes"><with-param pos="3"/></call-macro>
        
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="grau"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <!-- We set use chunk defnes here for both adj and nom,
                   so that if defnes changes in t2x/t3x, both adj and nom
                   get the change in t4x -->
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="grau"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <!-- We set use chunk defnes here for both adj and nom,
                   so that if defnes changes in t2x/t3x, both adj and nom
                   get the change in t4x -->
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="2"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: ADJ_ATTR ADJ_ATTR NOM.CMP NOM
                   -----
                   ođđa digitála heahtefierpmádat => det nye digitale nødnettverket
                   TODO: epenthesis!
                   Moves syn_label from CMP to NOM">
      <pattern>
        <pattern-item n="adj_attr"/>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        
        <call-macro n="modify_adj_gen_nbr"><with-param pos="4"/><with-param pos="1"/></call-macro>
        <call-macro n="modify_adj_gen_nbr"><with-param pos="4"/><with-param pos="2"/></call-macro>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="3"/></call-macro>

        <!-- most likely both ADJ and NOM are ind: -->
        <let><var n="defnes"/><lit-tag v="ind"/></let>

        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="grau"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <!-- We set use chunk defnes here for both adj and nom,
                   so that if defnes changes in t2x/t3x, both adj and nom
                   get the change in t4x -->
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="grau"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <!-- We set use chunk defnes here for both adj and nom,
                   so that if defnes changes in t2x/t3x, both adj and nom
                   get the change in t4x -->
              <lit-tag v="3"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="2"/>
            <lit v="^"/>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="3" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        <let><var n="c_name"/><lit v="pre_pre_pre_"/></let>        
        <call-macro n="copy_syn_label"><with-param pos="4"/><with-param pos="1"/></call-macro>
        <call-macro n="set_defnes"><with-param pos="4"/></call-macro>
        <call-macro n="out_nom"><with-param pos="4"/></call-macro>
      </action>
    </rule>


    <rule comment="REGLA: ADJ_ATTR NOM.CMP NOM
                   -----
                   duiska okkupašuvdnafápmu => tysk okkupasjonsmakt
                   TODO: epenthesis!
                   Moves syn_label from CMP to NOM">
      <pattern>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        
        <call-macro n="modify_adj_gen_nbr"><with-param pos="3"/><with-param pos="1"/></call-macro>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="2"/></call-macro>

        <!-- most likely both ADJ and NOM are ind: -->
        <let><var n="defnes"/><lit-tag v="ind"/></let>

        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="grau"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <!-- We set use chunk defnes here for both adj and nom,
                   so that if defnes changes in t2x/t3x, both adj and nom
                   get the change in t4x -->
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        <let><var n="c_name"/><lit v="pre_pre_"/></let>        
        <call-macro n="copy_syn_label"><with-param pos="3"/><with-param pos="2"/></call-macro>
        <call-macro n="set_defnes"><with-param pos="3"/></call-macro>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: ADJ_ATTR NOM.CMP NOM.CMP NOM
                   -----
                   Dalá Ruvdnaprinsabáras => Daværende Kronprinsparet
                   Moves syn_label from CMP to NOM">
      <pattern>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        
        <call-macro n="modify_adj_gen_nbr"><with-param pos="4"/><with-param pos="1"/></call-macro>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="2"/></call-macro>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="3"/></call-macro>

        <!-- most likely both ADJ and NOM are ind: -->
        <let><var n="defnes"/><lit-tag v="ind"/></let>

        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="grau"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <!-- We set use chunk defnes here for both adj and nom,
                   so that if defnes changes in t2x/t3x, both adj and nom
                   get the change in t4x -->
              <lit-tag v="3"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
              <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="2" side="tl" part="lemq"/>
              <lit v="$"/>
            <lit v="^"/>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="3" side="tl" part="lemq"/>
              <lit v="$"/>
          </concat>
        </let>
        <let><var n="c_name"/><lit v="pre_pre_pre_"/></let>        
        <call-macro n="copy_syn_label"><with-param pos="4"/><with-param pos="2"/></call-macro>
        <call-macro n="set_defnes"><with-param pos="4"/></call-macro>
        <call-macro n="out_nom"><with-param pos="4"/></call-macro>
      </action>
    </rule>
    
    <rule comment="REGLA: PRON-NONREFERENTIAL NOM.@→P
                   (Ii daddjo)  mihkkege almenneha  (birra) → noe om allmenningen
                   Don't chunk in this case.">
      <pattern>
        <pattern-item n="pron-nonreferential"/>
        <pattern-item n="nom_rP"/>
      </pattern>
      <action>
        <call-macro n="clean_a_det"><with-param pos="1"/></call-macro>

        <call-macro n="set_caseprep"><with-param pos="1"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="1"/></call-macro>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <let><clip pos="1" side="tl" part="nbr"/><lit-tag v="sg"/></let>
        <let><clip pos="1" side="tl" part="gen"/><lit-tag v="nt"/></let>
        <out>
          <var n="caseprep"/>
          <chunk name="det" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <clip pos="1" side="tl" part="case"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
          <b pos="1"/>
        </out>
        <call-macro n="set_caseFirstWord"><with-param pos="2"/></call-macro>
        <let><var n="c_name"/><lit v=""/></let>
        <let><var n="pre-nom"/><lit v=""/></let>
        <call-macro n="set_defnes"><with-param pos="2"/></call-macro>
        <call-macro n="out_nom"><with-param pos="2"/></call-macro>
      </action>
    </rule>
    <rule comment="REGLA: DET NOM
                   du bávččas => din smerte
                   eará sámi => annen same">
      <pattern>
        <pattern-item n="det_mod"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <!-- TODO earáin ruovttusiidduide => av_andre til_hjemmesidene: -->
        <!-- <exception><test><not><equal><clip pos="1" side="sl" part="case"/><clip pos="2" side="sl" part="case"/></equal></not></test></exception> -->
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="clean_a_det"><with-param pos="1"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="1"/></call-macro>
        <call-macro n="set_pron_gen_nbr_art"><with-param pos="2"/></call-macro>

        <call-macro n="set_defnes2"><with-param pos="2"/><with-param pos="1"/></call-macro>
        <let><var n="c_name"/><lit v="pre_"/></let>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
            <clip pos="1" side="tl" part="lemh"/>
            <clip pos="1" side="tl" part="a_det"/>
            <var n="pron_gen"/>
            <var n="pron_nbr"/>
            <clip pos="1" side="tl" part="art"/>
            <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="2"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: DET NOM.CMP NOM
                   eará skuvlamánáin => andre skolebarnene">
      <pattern>
        <pattern-item n="det_mod"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="clean_a_det"><with-param pos="1"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="1"/></call-macro>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="2"/></call-macro>
        <call-macro n="set_pron_gen_nbr_art"><with-param pos="3"/></call-macro>
        <call-macro n="set_defnes2"><with-param pos="3"/><with-param pos="1"/></call-macro>
        
        <let><var n="c_name"/><lit v="pre_pre_"/></let>
        <call-macro n="copy_syn_label"><with-param pos="3"/><with-param pos="2"/></call-macro>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_det"/>
              <var n="pron_gen"/>
              <var n="pron_nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>
    
    <rule comment="REGLA: DET NOM.CMP NOM.CMP NOM
                   du idjabeavdeskuffas => i din nattbordskuff">
      <pattern>
        <pattern-item n="det_mod"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="clean_a_det"><with-param pos="1"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="1"/></call-macro>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="2"/></call-macro>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="3"/></call-macro>
        <call-macro n="set_pron_gen_nbr_art"><with-param pos="4"/></call-macro>
        <call-macro n="set_defnes2"><with-param pos="4"/><with-param pos="1"/></call-macro>
        
        <let><var n="c_name"/><lit v="pre_pre_pre_"/></let>
        <call-macro n="copy_syn_label"><with-param pos="4"/><with-param pos="2"/></call-macro>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_det"/>
              <var n="pron_gen"/>
              <var n="pron_nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
            <lit v="^"/>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_nom"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <clip pos="3" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="3" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="4"/></call-macro>
      </action>
    </rule>
     
    <rule comment="REGLA: DET ADJ_ATTR NOM
                   min nuoramus bártni => til vår yngste gutt
                   min nuoramus olbmot => våre yngste mennesker
                   du deháleamos doaibma => din viktigste oppgave
                   mu stuora givssi => til min store plage
                   juohke lágán geđggiiguin => med alle slags steiner
                   TODO: demonstrative 'denne viktige oppgaven' (def!)">
      <pattern>
        <pattern-item n="det_mod"/>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="clean_a_det"><with-param pos="1"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="1"/></call-macro>
        <call-macro n="set_pron_gen_nbr_art"><with-param pos="3"/></call-macro>

        <call-macro n="modify_adj_gen_nbr"><with-param pos="3"/><with-param pos="2"/></call-macro>
        
        <let><var n="c_name"/><lit v="pre_pre_"/></let>
        <call-macro n="set_defnes2"><with-param pos="3"/><with-param pos="1"/></call-macro>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_det"/>
              <var n="pron_gen"/>
              <var n="pron_nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="grau"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <lit-tag v="def"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="2"/>
          </concat>
        </let>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: NOM.GEN DET ADJ_ATTR NOM
                   -----
                   riikka nubbi davvisámegiel namma => landets andre nordsamiske navn
                   Sets defnes of possessor NOM.GEN using set_defnes, defnes of possessed NOM is ind.
                   Ensure det is definite (using clip, only sets if it has a defnes tag).">
      <pattern>
        <pattern-item n="nom.gen"/>
        <pattern-item n="det_mod"/>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="clean_a_det"><with-param pos="2"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="2"/></call-macro>
        <call-macro n="set_pron_gen_nbr_art"><with-param pos="4"/></call-macro>
        <let><clip pos="2" side="tl" part="art"/><lit-tag v="def"/></let>

        <call-macro n="modify_adj_gen_nbr"><with-param pos="4"/><with-param pos="3"/></call-macro>
        
        <let><var n="c_name"/><lit v="pre_pre_pre_"/></let>

        <!-- for NOM.GEN -->
        <call-macro n="set_defnes"><with-param pos="1"/></call-macro>
        <choose><when>
          <test><begins-with><clip pos="1" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with></test>
          <let><var n="defnes"/><lit v=""/></let>
          <let><clip pos="1" side="tl" part="nbr"/><lit v=""/></let>
        </when></choose>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <var n="defnes"/>
              <clip pos="1" side="tl" part="gen-case"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_det"/>
              <var n="pron_gen"/>
              <var n="pron_nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="2"/>
            <lit v="^"/>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="grau"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="def"/>
              <clip pos="3" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="3"/>
          </concat>
        </let>
        
        <!-- for possessed NOM -->        
        <let><var n="defnes"/><lit-tag v="ind"/></let>
        <call-macro n="out_nom"><with-param pos="4"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: ADJ_ATTR NOM.GEN ADJ_ATTR NOM
                   -----
                   Son lea nuorra Ristena boares biilla siste. => Han/Hun er i unge Ristens gamle bilen.
                   Sets defnes of possessor NOM.GEN using set_defnes, defnes of possessed NOM is ind.
                   Ensure det is definite (using clip, only sets if it has a defnes tag).">
      <pattern>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom.gen"/>
        <pattern-item n="adj_attr"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="modify_adj_gen_nbr"><with-param pos="4"/><with-param pos="3"/></call-macro>
        <call-macro n="modify_adj_gen_nbr"><with-param pos="2"/><with-param pos="1"/></call-macro>
        
        <let><var n="c_name"/><lit v="pre_pre_pre_"/></let>

        <!-- for NOM.GEN -->
        <call-macro n="set_defnes"><with-param pos="2"/></call-macro>
        <choose><when>
          <test><begins-with><clip pos="2" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with></test>
          <let><var n="defnes"/><lit v=""/></let>
          <let><clip pos="2" side="tl" part="nbr"/><lit v=""/></let>
        </when></choose>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adj"/>
              <clip pos="1" side="tl" part="grau"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="def"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <var n="defnes"/>
              <clip pos="2" side="tl" part="gen-case"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="2"/>
            <lit v="^"/>
              <clip pos="3" side="tl" part="lemh"/>
              <clip pos="3" side="tl" part="a_adj"/>
              <clip pos="3" side="tl" part="grau"/>
              <clip pos="3" side="tl" part="gen"/>
              <clip pos="3" side="tl" part="nbr"/>
              <lit-tag v="def"/>
              <clip pos="3" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="3"/>
          </concat>
        </let>
        
        <!-- for possessed NOM -->        
        <let><var n="defnes"/><lit-tag v="ind"/></let>
        <call-macro n="out_nom"><with-param pos="4"/></call-macro>
      </action>
    </rule>
    
    <rule comment="REGLA: DET ADJ
                   -----
                   Always definite in nob if det is a possessive,
                   TODO: defnes for other determiners, perhaps need c_def_pos
                   TODO: is this a common pattern?">
      <pattern>
        <pattern-item n="det_mod"/>
        <pattern-item n="adj"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="clean_a_det"><with-param pos="1"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="1"/></call-macro>
        <call-macro n="set_pron_gen_nbr_art"><with-param pos="2"/></call-macro>
        <call-macro n="set_c_gen_nbr"><with-param pos="2"/></call-macro>

        <let><var n="defnes"/><lit-tag v="def"/></let>
        
        <call-macro n="set_caseprep"><with-param pos="2"/></call-macro>

        <out>
          <var n="caseprep"/>
          <chunk name="pre_adj" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SA"/></tag>
              <tag><clip pos="2" side="sl" part="syn_label"/></tag>
              <tag><var n="defnes"/></tag>
              <tag><clip pos="2" side="sl" part="mode"/></tag>
              <tag><var n="c_gen"/></tag>
              <tag><var n="c_nbr"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_det"/>
              <var n="pron_gen"/>
              <var n="pron_nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
            <b pos="1"/>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_adj"/>
              <clip pos="2" side="tl" part="grau"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <var n="defnes"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: NOM.PROP_GEN NOM
                   -----
                   Defnes of possessed NOM is ind (NOM.PROP has no defnes).
                   Needs to be before NOM.GEN NOM">
      <pattern>
        <pattern-item n="nom.prop.gen"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <let><var n="c_name"/><lit v="pre_"/></let>
        <choose><when>
          <test><in><clip pos="2" side="tl" part="lemh"/><list n="no-gen-after-prop"/></in></test>
          <let><clip pos="1" side="tl" part="gen-case"/><lit v=""/></let>
        </when></choose>
        
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="gen-case"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
          </concat>
        </let>        
        <!-- for possessed NOM -->        
        <let><var n="defnes"/><lit-tag v="ind"/></let>
        <call-macro n="out_nom"><with-param pos="2"/></call-macro>
      </action>
    </rule>
    
    <rule comment="REGLA: NOM.GEN NOM
                   -----
                   Sets defnes of possessor NOM.GEN using set_defnes, defnes of possessed NOM is ind.">
      <pattern>
        <pattern-item n="nom.gen"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <let><var n="c_name"/><lit v="pre_"/></let>

        <!-- for NOM.GEN -->
        <call-macro n="set_defnes"><with-param pos="1"/></call-macro>
        <choose><when>
          <test><begins-with><clip pos="1" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with></test>
          <let><var n="defnes"/><lit v=""/></let>
          <let><clip pos="1" side="tl" part="nbr"/><lit v=""/></let>
        </when></choose>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <var n="defnes"/>
              <clip pos="1" side="tl" part="gen-case"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
          </concat>
        </let>
        
        <!-- for possessed NOM -->        
        <let><var n="defnes"/><lit-tag v="ind"/></let>
        <call-macro n="out_nom"><with-param pos="2"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: NOM.PROP_GEN NOM.CMP NOM
                   -----
                   Defnes of possessed NOM is ind (NOM.PROP has no defnes).
                   Needs to be before NOM.GEN NOM">
      <pattern>
        <pattern-item n="nom.prop.gen"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <let><var n="c_name"/><lit v="pre_pre_"/></let>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="2"/></call-macro>        
        <call-macro n="copy_syn_label"><with-param pos="3"/><with-param pos="2"/></call-macro>

        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="gen-case"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>        
        <!-- for possessed NOM -->        
        <let><var n="defnes"/><lit-tag v="ind"/></let>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: NOM.GEN NOM.CMP NOM
                   -----
                   Sets defnes of possessor NOM.GEN using set_defnes, defnes of possessed NOM is ind.">
      <pattern>
        <pattern-item n="nom.gen"/>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <let><var n="c_name"/><lit v="pre_pre_"/></let>
        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="2"/></call-macro>

        <call-macro n="copy_syn_label"><with-param pos="3"/><with-param pos="2"/></call-macro>

        <!-- for NOM.GEN -->
        <call-macro n="set_defnes"><with-param pos="1"/></call-macro>
        <choose><when>
          <test><begins-with><clip pos="1" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with></test>
          <let><var n="defnes"/><lit v=""/></let>
          <let><clip pos="1" side="tl" part="nbr"/><lit v=""/></let>
        </when></choose>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <var n="defnes"/>
              <clip pos="1" side="tl" part="gen-case"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <clip pos="2" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>
        
        <!-- for possessed NOM -->        
        <let><var n="defnes"/><lit-tag v="ind"/></let>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>

    <rule comment="REGLA: DET NOM.GEN NOM
                   -----
                   dán jagi válggas => dette år(et)s valg
                   Sets defnes of possessor NOM.GEN based on DET, defnes of possessed NOM is ind.">
      <pattern>
        <pattern-item n="det_mod"/>
        <pattern-item n="nom.gen"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="clean_a_det"><with-param pos="1"/></call-macro>
        <call-macro n="modify_pron_case"><with-param pos="1"/></call-macro>
        <call-macro n="set_pron_gen_nbr_art"><with-param pos="2"/></call-macro>

        <let><var n="c_name"/><lit v="pre_pre_"/></let>

        <!-- for NOM.GEN -->
        <call-macro n="set_defnes2"><with-param pos="2"/><with-param pos="1"/></call-macro>
        <choose><when>
          <test><begins-with><clip pos="2" side="tl" part="a_nom"/><lit-tag v="np"/></begins-with></test>
          <let><var n="defnes"/><lit v=""/></let>
          <let><clip pos="2" side="tl" part="nbr"/><lit v=""/></let>
        </when></choose>
        <let>
          <var n="pre-nom"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_det"/>
              <var n="pron_gen"/>
              <var n="pron_nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="1"/>
            <lit v="^"/>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_nom"/>
              <clip pos="2" side="tl" part="gen"/>
              <clip pos="2" side="tl" part="nbr"/>
              <var n="defnes"/>
              <clip pos="2" side="tl" part="gen-case"/>
              <clip pos="2" side="tl" part="lemq"/>
            <lit v="$"/>
            <b pos="2"/>
          </concat>
        </let>
        
        <!-- for possessed NOM -->        
        <let><var n="defnes"/><lit-tag v="ind"/></let>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
      </action>
    </rule>



    <rule comment="REGLA: NUMERAL">
      <pattern>
        <pattern-item n="num"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="det" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN"/></tag>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="case"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_num"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="a_cmp"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
        <let><var n="previous-nhead"/><lit v="NUMERAL"/></let>
      </action>
    </rule>



    <!-- <rules VERBS ETC. -->        
    
    <rule comment="REGLA: VERB (tl: VERB, ADV, ADJ, NOUN)
                   See out_verb macro.
                   -----
                   dansún => dans (noun, explicitly in bidix)
                   oažžun => fående (adj.pprs, using fallback rule)
                   ii => adv.p3.sg{ikke}
                   Itgo => adv.p2.sg.Qst{ikke}">
      <pattern>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <let><var n="pre-verb"/><lit v=""/></let>
        <let><var n="c_name"/><lit v=""/></let>
        <call-macro n="out_verb"><with-param pos="1"/></call-macro>
      </action>
    </rule>    
    
    <rule comment="REGLA: VERB Der/goahti: lohka+gohten => begynne å si
                   needs to be several chunks to cover: ii lohkagoađe => han begynner ikke å si
                   TODO: caseSecondWord
                   TODO: insert 'i gang med å' if actio ess
                   TODO: pret pass exception">
      <pattern>
        <pattern-item n="verb"/>
        <pattern-item n="goahti-v"/>
      </pattern>
      <action>
        <call-macro n="switch_cases"><with-param pos="2"/><with-param pos="1"/></call-macro>
        <call-macro n="copy_syn_label"><with-param pos="2"/><with-param pos="1"/></call-macro>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="verb" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV"/></tag>
              <tag><clip pos="2" side="sl" part="syn_label"/></tag>
              <tag><clip pos="2" side="sl" part="mode"/></tag>
              <tag><clip pos="2" side="sl" part="modality"/></tag>
              <tag><clip pos="2" side="tl" part="temps"/></tag>
              <tag><clip pos="2" side="tl" part="voice"/></tag>
              <tag><clip pos="2" side="tl" part="pers"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
              <tag><clip pos="1" side="tl" part="animacy"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="a_pstv"/>
              <clip pos="2" side="tl" part="temps"/>
              <clip pos="2" side="tl" part="voice"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
          <b pos="1"/>
          <chunk name="part">
            <tags>
              <tag><lit-tag v="part"/></tag>
            </tags>
            <lu>
              <lit v="å"/><lit-tag v="part"/>
            </lu>
          </chunk>
          <b/>
        </out>
        <call-macro n="set_caseFirstWord"><with-param pos="2"/></call-macro>
        <let><var n="pre-verb"/><lit v=""/></let>
        <let><var n="c_name"/><lit v=""/></let>
        <let><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@-FMAINV"/></let>
        <!-- There is no temps on pos=1 in this construction, so we just append one to the pstv tags (or, if empty, to the verb tags): -->
        <let><clip pos="1" side="tl" part="a_pstv"/><concat><clip pos="1" side="tl" part="a_pstv"/><lit-tag v="inf"/></concat></let>
        <choose><when>
          <test><equal><clip pos="1" side="tl" part="a_pstv"/><lit v=""/></equal></test>
          <let><clip pos="1" side="tl" part="a_verb"/><concat><clip pos="1" side="tl" part="a_verb"/><lit-tag v="inf"/></concat></let>
        </when></choose>
        <call-macro n="out_verb"><with-param pos="1"/></call-macro>
      </action>
    </rule>
    
    <rule comment="REGLA: NOM.CMP VERB
                   -----
                   skuvlavázzima => skolegående
                   (should be 'skolegang', but if it's not in bidix, adj.pprs is the best we can do)">
      <pattern>
        <pattern-item n="nom.cmp"/>
        <pattern-item n="verb"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>

        <call-macro n="modify_nomcmp_nbr_art"><with-param pos="1"/></call-macro>
        <call-macro n="copy_syn_label"><with-param pos="2"/><with-param pos="1"/></call-macro>
        <let><clip pos="1" side="tl" part="syn_label"/><lit v=""/></let>

        <let><var n="c_name"/><lit v="pre_"/></let>
        <let>
          <var n="pre-verb"/>
          <concat>
            <lit v="^"/>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_nom"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <clip pos="1" side="tl" part="art"/>
              <lit-tag v="cmp"/>
              <clip pos="1" side="tl" part="lemq"/>
            <lit v="$"/>
          </concat>
        </let>

        <call-macro n="out_verb"><with-param pos="2"/></call-macro>
      </action>
    </rule>

    <!-- <rules: NOM/PRON V.ACTIO NOM -->
    <rule comment="REGLA: PRON.PERS.GEN V.ACTIO NOM
                   -----
                   du čállin reivve => brevet som du hadde skrevet
                   The Agent Construction.
TODO! We make several chunks, should be possible to handle in interchunk like
   other relative clauses; perhaps we could make t2x relative chunking rules.
TODO sin geargan áššiin
TODO: should we restrict to V.Actio.Nom/Gen ?">
      <pattern>
        <pattern-item n="pron.pers.gen"/>
        <pattern-item n="v.actio"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <let><var n="c_name"/><lit v=""/></let>
        <let><var n="pre-nom"/><lit v=""/></let>
        <call-macro n="set_defnes"><with-param pos="3"/></call-macro>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
        
        <call-macro n="set_caseFirstWord"><with-param pos="2"/></call-macro>
        <out>
          <b pos="1"/>
          <chunk name="rel" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="@OBJ→"/></tag>
              <tag><lit-tag v="Acc"/></tag>
            </tags>
            <lu><lit v="som"/><lit-tag v="cnjsub"/></lu>
          </chunk>
          <b/>
          <chunk name="pron" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SN.@SUBJ→"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
              <tag><clip pos="1" side="tl" part="pers"/></tag>
              <tag><clip pos="1" side="tl" part="gen"/></tag>
              <tag><clip pos="1" side="tl" part="nbr"/></tag>
              <tag><lit-tag v="nom"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_pron"/>
              <clip pos="1" side="tl" part="a_det"/>
              <clip pos="1" side="tl" part="pers"/>
              <clip pos="1" side="tl" part="gen"/>
              <clip pos="1" side="tl" part="nbr"/>
              <lit-tag v="nom"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>

        <call-macro n="set_caseFirstWord"><with-param pos="3"/></call-macro>
        <out>
          <b pos="2"/>
          <chunk name="verb" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV.@+FAUXV"/></tag>
              <tag><clip pos="2" side="sl" part="mode"/></tag>
              <tag><clip pos="2" side="sl" part="modality"/></tag>
              <tag><lit-tag v="pret"/></tag>
              <tag><clip pos="2" side="tl" part="voice"/></tag>
              <tag><clip pos="2" side="tl" part="pers"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
              <tag><clip pos="2" side="tl" part="animacy"/></tag>
            </tags>
            <lu>
              <lit v="ha"/><lit-tag v="vblex.pret"/>
            </lu>
          </chunk>
          <b/>
        </out>
        <let><var n="c_name"/><lit v=""/></let>
        <let><clip pos="2" side="tl" part="temps"/><lit-tag v="pp"/></let>
        <call-macro n="out_verb"><with-param pos="2"/></call-macro>
      </action>
    </rule>
    <rule comment="REGLA: NOM.GEN V.ACTIO NOM
                   -----
                   irggi čállin reivve => brevet som kjæresten hadde skrevet
                   The Agent Construction. See above rule.">
      <pattern>
        <pattern-item n="nom.gen"/>
        <pattern-item n="v.actio"/>
        <pattern-item n="nom_head"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <let><var n="c_name"/><lit v=""/></let>
        <let><var n="pre-nom"/><lit v=""/></let>
        <call-macro n="set_defnes"><with-param pos="3"/></call-macro>
        <call-macro n="out_nom"><with-param pos="3"/></call-macro>
        
        <call-macro n="set_caseFirstWord"><with-param pos="2"/></call-macro>
        <out>
          <b pos="1"/>
          <chunk name="rel" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="@OBJ→"/></tag>
              <tag><lit-tag v="Acc"/></tag>
            </tags>
            <lu><lit v="som"/><lit-tag v="cnjsub"/></lu>
          </chunk>
          <b/>
        </out>
        
        <let><clip pos="1" side="sl" part="syn_label"/><lit-tag v="@SUBJ→"/></let>
        <let><clip pos="1" side="sl" part="case"/><lit-tag v="Nom"/></let>
        <let><clip pos="1" side="tl" part="case"/><lit v="nom"/></let>
        <let><var n="c_name"/><lit v=""/></let>
        <let><var n="pre-nom"/><lit v=""/></let>
        <call-macro n="set_defnes"><with-param pos="1"/></call-macro>
        <call-macro n="out_nom"><with-param pos="1"/></call-macro>

        <call-macro n="set_caseFirstWord"><with-param pos="3"/></call-macro>
        <out>
          <b pos="2"/>
          <chunk name="verb" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV.@+FAUXV"/></tag>
              <tag><clip pos="2" side="sl" part="mode"/></tag>
              <tag><clip pos="2" side="sl" part="modality"/></tag>
              <tag><lit-tag v="pret"/></tag>
              <tag><clip pos="2" side="tl" part="voice"/></tag>
              <tag><clip pos="2" side="tl" part="pers"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
              <tag><clip pos="2" side="tl" part="animacy"/></tag>
            </tags>
            <lu>
              <lit v="ha"/><lit-tag v="vblex.pret"/>
            </lu>
          </chunk>
          <b/>
          <chunk name="verb" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="SV.@-FMAINV"/></tag>
              <tag><clip pos="2" side="sl" part="mode"/></tag>
              <tag><clip pos="2" side="sl" part="modality"/></tag>
              <tag><lit-tag v="pp"/></tag>
              <tag><clip pos="2" side="tl" part="pers"/></tag>
              <tag><clip pos="2" side="tl" part="nbr"/></tag>
              <tag><clip pos="2" side="tl" part="animacy"/></tag>
            </tags>
            <lu>
              <clip pos="2" side="tl" part="lemh"/>
              <clip pos="2" side="tl" part="a_verb"/>
              <clip pos="2" side="tl" part="a_pstv"/>
              <lit-tag v="pp"/>
              <clip pos="2" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>


    <!-- SINGLE CLOSED CLASS WORDS: -->

    <rule comment="REGLA: CONJ">
      <pattern>
        <pattern-item n="conj"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="conj" case="caseFirstWord">
            <tags>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="tl" part="a_conj"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_conj"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: ADPOS">
      <pattern>
        <pattern-item n="adpos"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="adpos" case="caseFirstWord">
            <tags>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_prep"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: ADV">
      <pattern>
        <pattern-item n="adverb"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <choose>
          <when c="Since we match on chunk lemma 'adv' in t3x, we have a two-lu chunks
                   here with the single name 'adv' (no postchunking rules for adverbs, so that's OK).">
            <test><equal><clip pos="1" side="sl" part="mode"/><lit-tag v="Qst"/></equal></test>
            <out>
              <chunk name="adv" case="caseFirstWord">
                <tags>
                  <tag><clip pos="1" side="sl" part="syn_label"/></tag>
                  <tag><clip pos="1" side="sl" part="mode"/></tag>
                </tags>
                <lu><lit v="hvor"/><lit-tag v="adv"/></lu>
                <b/>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adv"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </when>
          <otherwise>        
            <out>
              <chunk name="adv" case="caseFirstWord">
                <tags>
                  <tag><clip pos="1" side="sl" part="syn_label"/></tag>
                  <tag><clip pos="1" side="sl" part="mode"/></tag>
                </tags>
                <lu>
                  <clip pos="1" side="tl" part="lemh"/>
                  <clip pos="1" side="tl" part="a_adv"/>
                  <clip pos="1" side="tl" part="lemq"/>
                </lu>
              </chunk>
            </out>
          </otherwise>
        </choose>
      </action>
    </rule>
    <rule comment="REGLA: adverb Qst.Pcle
                   guhká go => hvor lenge
                   Since we match on chunk lemma 'adv' in t3x, even two-lu chunks
                   here are named 'adv' (no postchunking rules, so that's OK).

TODO: this should be an mwe in the analyser.">
      <pattern>
        <pattern-item n="adverb"/>
        <pattern-item n="Qst.Pcle"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <out>
          <chunk name="adv" case="caseFirstWord">
            <tags>
              <tag><clip pos="1" side="sl" part="syn_label"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
            </tags>
            <lu><lit v="hvor"/><lit-tag v="adv"/></lu>
            <b/>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adv"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    
    <rule comment="REGLA: Pcle
                   ba => engang">
      <pattern>
        <pattern-item n="Pcle"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <let><var n="c_syn"/><clip pos="1" side="sl" part="syn_label"/></let>
        <choose><when>
          <test><equal><var n="c_syn"/><lit v=""/></equal></test>
          <let><var n="c_syn"/><lit-tag v="@PCLE"/></let>
        </when></choose>
        <out>
          <chunk name="adv" case="caseFirstWord">
            <tags>
              <tag><var n="c_syn"/></tag>
              <tag><clip pos="1" side="sl" part="mode"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adv"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: Interj / ij">
      <pattern>
        <pattern-item n="ij"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <let><var n="c_syn"/><clip pos="1" side="sl" part="syn_label"/></let>
        <out>
          <chunk name="ij" case="caseFirstWord">
            <tags>
              <tag><var n="c_syn"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_ij"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
    <rule comment="REGLA: CMP">
      <pattern>
        <pattern-item n="cmp"/>
      </pattern>
      <action>
        <call-macro n="set_caseFirstWord"><with-param pos="1"/></call-macro>
        <let><var n="c_syn"/><clip pos="1" side="sl" part="syn_label"/></let>
        <out>
          <chunk name="adv" case="caseFirstWord">
            <tags>
              <tag><var n="c_syn"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="lemh"/>
              <clip pos="1" side="tl" part="a_adv"/>
              <clip pos="1" side="tl" part="lemq"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>

    <rule comment="REGLA: CLB">
      <pattern>
        <pattern-item n="CLB"/>
      </pattern>
      <action>
        <out>
          <chunk name="clb" case="caseFirstWord">
            <tags>
              <tag><lit-tag v="CLB"/></tag>
              <tag><clip pos="1" side="tl" part="tags"/></tag>
            </tags>
            <lu>
              <clip pos="1" side="tl" part="whole"/>
            </lu>
          </chunk>
        </out>
      </action>
    </rule>
  </section-rules>
</transfer>
